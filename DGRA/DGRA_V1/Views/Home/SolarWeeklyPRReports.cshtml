@using Newtonsoft.Json;
@using Microsoft.AspNetCore.Http;
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Solar Weekly Reports";
}
@{
    string windSiteList = "";
    var usermodel = JsonConvert.DeserializeObject<UserAccess>(@HttpContextAccessor.HttpContext.Session.GetString("UserAccess"));

}
@for (int i = 0; i < @usermodel.access_list.Count; i++)
{

    if (@usermodel.access_list[i].page_type == 3 && @usermodel.access_list[i].site_type == 2)
    {
        windSiteList += @usermodel.access_list[i].identity.ToString() + ",";
    }
}
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<!-- Font Awesome -->
<link rel="stylesheet" href="~/Content/theme/plugins/fontawesome-free/css/all.min.css">
<!-- daterange picker -->
<link rel="stylesheet" href="~/Content/theme/plugins/daterangepicker/daterangepicker.css">
<!-- DataTables -->
<link rel="stylesheet" href="~/Content/theme/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="~/Content/theme/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
<link rel="stylesheet" href="~/Content/theme/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
<!-- dropdown search -->
<link href="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.js"></script>



<link href="~/Content/theme/dist/css/adminlte.css" rel="stylesheet" />
<style>
    .tab-btn {
        font-size: 0.7rem;
        font-weight: bold;
    }

    .card-body {
    }
    hr {
        margin-top: -10px !important;
    }
   
</style>

<div class="content-wrapper">

    <section class="content-header">
    </section>

    <section class="content">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title text-center">Solar Weekly Performance Reports</h3>
            </div>
          

        <div class="card-body">
            <div class="tab-content" id="custom-tabs-two-tabContent">
                <div class="tab-pane fade show active" id="custom-tabs-two-op" role="tabpanel" aria-labelledby="custom-tabs-two-op-tab">
                    <div class="row">
                        <!--<div class="col-sm-4">
            <div class="form-group">
                <div class="row">
                    <label class="col-sm-4 col-form-label text-right">FY : </label>
                    <select class="form-control  col-sm-8" id="fy" name="fy" value="">
                        <option value="">Select Financial Year</option>
                    </select>
                </div>
            </div>
        </div>-->
                        <div class="col-sm-4">
                            <div class="input-group " >
                                <label class="col-sm-2 col-form-label text-left">Date : </label>
                                <div class="input-group-prepend">
                                    <span class="input-group-text">
                                        <i class="far fa-calendar-alt"></i>
                                    </span>
                                </div>
                                <input type="text" class="form-control float-right" id="daterange" name="daterange">
                            </div>
                        </div>

                        <div class="col-sm-2">
                            <button type="button" class="btn btn-block btn-primary" onclick="GetOperationWKPR();">Search</button>
                        </div>
                        <div class="col-sm-6"></div>

                    </div>
                    <br>
                    <hr>
                    <div id="loader" class="loader  center" style="display:none"></div>
                    <div class="row" id="wk_head" style="display:none">
                        <div class="col-sm-5 text-center" id="wk_head_sec1">

                        </div>
                        <div class="col-sm-3" id="wk_head_sec2">

                        </div>
                        <div class="col-sm-4" id="wk_head_sec3">

                        </div>

                    </div>
                    <hr>
                    <div class="row">
                        <div class="chart col-sm-4" style="padding:10px;">
                            <canvas id="energy_mu_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                        <div class="chart col-sm-4" style="padding:10px;">
                            <canvas id="wind_sp_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                        <div class="chart col-sm-4" style="padding:10px;">
                            <canvas id="plf_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                    </div>
                    <hr>

                    <div class="row">

                        <div class="chart col-sm-4 " style="padding:10px;">
                            <canvas id="ma_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                        <div class="chart col-sm-4" style="padding:10px;">
                            <canvas id="ega_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                        <div class="chart col-sm-4" style="padding:10px;">
                            <canvas id="iga_chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                    </div>
                    <hr>

                    <br>
                    <div class="card-header">
                        <h3 class="card-title text-center">Performance By Site</h3>
                    </div>
                    <br>
                    <div id="reportsDailySite" style="overflow-x: auto;" class="reportsDailySite"></div>
                    <br>
                    <div class="row" id="sitewisechart">
                        <div class="chart col-sm-6 text-center">
                            <!--<h5>Energy (MUs) </h5>-->
                            <canvas id="energy_chart_pr_site" style="min-height: 350px; height: 350px; max-height: 350px; max-width: 100%;"></canvas>
                        </div>
                        <div class="chart col-sm-6 text-center">
                            <!--<h5>PR (%)</h5>-->
                            <canvas id="wind_chart_pr_site" style="min-height: 350px; height: 350px; max-height: 350px; max-width: 100%;"></canvas>
                        </div>

                    </div>
                    <br>
                    <div class="card-header">
                        <h3 class="card-title text-center">Performance By SPV</h3>
                    </div>
                    <br>
                    <div id="reportsDailySPV" style="overflow-x: auto;" class="reportsDailySPV"></div>
                    <br>
                    <div class="row" id="sitewisechart">
                        <div class="chart col-sm-6 text-center">
                            <!--<h5>Energy (MUs) </h5>-->
                            <canvas id="energy_chart_pr_spv" style="min-height: 350px; height: 350px; max-height: 350px; max-width: 100%;"></canvas>
                        </div>
                        <div class="chart col-sm-6 text-center">
                            <!--<h5>PR (%)</h5>-->
                            <canvas id="wind_chart_pr_spv" style="min-height: 350px; height: 350px; max-height: 350px; max-width: 100%;"></canvas>
                        </div>

                    </div>
                    <hr>
                    <div class="card-header">
                        <h5 class="card-title text-center">Major Breakdown Reports</h5>
                    </div>
                    <br>
                    <div id="reportsMonthly" style="overflow-x: auto;" class="reportsMonthly"></div>

                </div>
                
            </div>
        </div>
</div>

        <!--<div class="card-footer">
            Footer
        </div>-->




    </section>

</div>
<script src="~/Content/theme/plugins/jquery/jquery.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="~/Content/theme/plugins/moment/moment.min.js"></script>
<script src="~/Content/theme/plugins/daterangepicker/daterangepicker.js" defer></script>
<script src="~/Content/theme/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>

<script src="~/Content/theme/plugins/summernote/summernote-bs4.min.js"></script>
<!--Datatable -->
<script src="~/Content/theme/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="~/Content/theme/plugins/datatables/jquery.dataTables.js" defer></script>

<script src="~/Content/theme/plugins/datatables-buttons/js/dataTables.buttons.min.js" defer></script>
<script src="~/Content/theme/plugins/jszip/jszip.min.js" defer></script>
<script src="~/Content/theme/plugins/datatables-buttons/js/buttons.html5.min.js" defer></script>
<script src="~/Content/theme/plugins/pdfmake/pdfmake.min.js" defer></script>
<script src="~/Content/theme/plugins/datatables-buttons/js/buttons.colVis.min.js" defer></script>

<script src="~/Content/theme/plugins/chart.js/Chart.min.js"></script>
<script src="~/Content/theme/dist/js/comman.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0-rc"></script>

<script type="text/javascript">
    var fyear ="";
    $(document).ready(function () {
        $('#daterange').daterangepicker(
            {
                singleDatePicker: true,
                maxDate: new Date(),
                locale: {
                    format: 'DD/MM/YYYY',
                }
            });

    });
    window.onload = function () {
        var today = new Date();
        fyear = getFinancialYear(today);
        //getYear();
    }
    var actual_mu = [];
    var target_mu = [];
    var var_mu_pos = [];
    var var_mu_neg = [];

    var actual_pr = [];
    var target_pr = [];
    var var_pr_pos = [];
    var var_pr_neg = [];
    var actual_ghi = [];
    var target_ghi = [];
    var var_ghi_pos = [];
    var var_ghi_neg = [];
    var actual_poa = [];
    var target_poa = [];
    var var_poa_pos = [];
    var var_poa_neg = [];
    var actual_plf = [];
    var target_plf = [];
    var var_plf_pos = [];
    var var_plf_neg = [];
    var actual_ma = [];
    var target_ma = [];
    var var_ma_pos = [];
    var var_ma_neg = [];
    var actual_iga = [];
    var target_iga = [];
    var var_iga_pos = [];
    var var_iga_neg = [];
    var actual_ega = [];
    var target_ega = [];
    var var_ega_pos = [];
    var var_ega_neg = [];
    var Diff_Mus = [];
    var revenue = [];
    /*function getYear() {
    $.ajax({
        type: "GET",
        url: "/WindReport/GetFinacialYear",
        contentType: "application/json; charset=utf-8",
        datatype: "html",
        success: function (result, status, xhr) {
            var options = "";
            options += '<option value="">Select Financial Year</option>';
            for (var i = 0; i < result.length; i++) {
                options += '<option value="' + result[i].financial_year + '">' + result[i].financial_year + '</option>';
            }
            $("#fy").html(options);
            $("#fy1").html(options);
            $('select#fy').multipleSelect({
                filter: true
            })
            $('select#fy1').multipleSelect({
                filter: true
            })
        }
    });
    }*/


    function GetOperationWKPR() {

        document.getElementById("loader").style.display = 'flex';
        GetPerformanceBySPV();
        GetPerformanceBySite();
        MajorBreakdown();
        var tar_energy_wk = 0;
        var act_energy_wk = 0;
        var energy_var_wk =0
        var tar_pr_wk = 0;
        var act_pr_wk = 0;
        var pr_var_wk = 0;
        var tar_ghi_wk = 0;
        var act_ghi_wk = 0;
        var ghi_var_wk = 0;
        var tar_poa_wk = 0;
        var act_poa_wk = 0;
        var poa_var_wk = 0;
        var tar_plf_wk = 0;
        var act_plf_wk = 0;
        var plf_var_wk = 0;
        var tar_ma_wk = 0;
        var act_ma_wk = 0;
        var ma_var_wk = 0;
        var tar_iga_wk = 0;
        var act_iga_wk = 0;
        var iga_var_wk = 0;
        var tar_ega_wk = 0;
        var act_ega_wk = 0;
        var ega_var_wk = 0;
        var total_revenue_wk = 0;
        var diff_MUs_wk = 0;
        var total_capacity = 0;
        var total_tarriff_wk = 0;
        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var seldate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        var fromDate = GetWeeklyDays(seldate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var fy = fyear;//$('select#fy option:selected').val();
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";

        $.ajax({
            type: "GET",
            url: '@Url.Action("GetWeeklyOperation", "SolarReport")' + '?fy=' + fy + '&fromDate=' + fromDate + '&toDate=' + toDate + '&site=' + site_ids + '&cnt=1',
            contentType: "application/json; charset=utf-8",
            datatype: "html",
            success: function (result, status, xhr) {
                actual_mu = [];
                target_mu = [];
                var_mu_pos = [];
                var_mu_neg = [];
                actual_pr = [];
                target_pr = [];
                var_pr_pos = [];
                var_pr_neg = [];
                actual_ghi = [];
                target_ghi = [];
                var_ghi_pos = [];
                var_ghi_neg = [];
                actual_poa = [];
                target_poa = [];
                var_poa_pos = [];
                var_poa_neg = [];
                actual_plf = [];
                target_plf = [];
                var_plf_pos = [];
                var_plf_neg = [];
                actual_ma = [];
                target_ma = [];
                var_ma_pos = [];
                var_ma_neg = [];
                actual_iga = [];
                target_iga = [];
                var_iga_pos = [];
                var_iga_neg = [];
                actual_ega = [];
                target_ega = [];
                var_ega_pos = [];
                var_ega_neg = [];
                Diff_Mus = [];
                revenue = [];

                for (var i = 0; i < result.length; i++) {
                    total_capacity += result[i].capacity;
                    tar_energy_wk += result[i].tar_kwh;
                    //total_expected_kwh += result[i].expected_kwh;
                    act_energy_wk += result[i].act_kwh;
                    //total_minr += minr;
                    total_tarriff_wk += result[i].total_tarrif;
                    tar_ghi_wk += result[i].tar_ghi * result[i].capacity;
                    act_ghi_wk += result[i].act_ghi * result[i].capacity;

                    tar_poa_wk += result[i].tar_poa * result[i].capacity;
                    act_poa_wk += result[i].act_poa * result[i].capacity;
                    console.log();
                    tar_plf_wk += result[i].tar_plf * result[i].capacity;
                    act_plf_wk += result[i].act_plf * result[i].capacity;
                    //total_capTarPr += result[i].tar_pr * result[i].capacity;
                   //total_capTarGain += gain_tar * result[i].capacity;
                    tar_ma_wk += result[i].tar_ma * result[i].capacity;
                    act_ma_wk += result[i].act_ma * result[i].capacity;

                    tar_iga_wk += result[i].tar_iga * result[i].capacity;
                    act_iga_wk += result[i].act_iga * result[i].capacity;

                    tar_ega_wk += result[i].tar_ega * result[i].capacity;
                    act_ega_wk += result[i].act_ega * result[i].capacity;
                    total_revenue_wk += (result[i].act_kwh - result[i].tar_kwh) * result[i].total_tarrif;
                   //act_ma_wk += act_prval * result[i].capacity;
                    //total_capActGain += gain_act * result[i].capacity;
                }
                let avg_t_var = 0;
                //let avg_e_var = (((avg_act_kwh - avg_expected_kwh) / avg_expected_kwh) * 100);
                let avg_tar_ghi = 0;
                let avg_ghi_var = 0;
                let avg_tar_plf = 0;
                let avg_plf_var = 0;
                let avg_tar_poa = 0;
                let avg_poa_var = 0;
                let avg_tar_gain = 0;
                let avg_gain_var = 0;
                let avg_tar_pr = 0;
                let avg_pr_var = 0;
                let avg_tar_ma = 0;
                let avg_ma_var = 0;
                let avg_tar_iga = 0;
                let avg_iga_var = 0;
                let avg_tar_ega = 0;
                let avg_ega_var = 0;
                let avg_act_ghi = 0
                let avg_act_poa = 0;
                let avg_act_plf = 0;
                let avg_act_gain = 0;
                let avg_act_pr = 0;
                let avg_act_ma = 0;
                let avg_act_iga = 0;
                let avg_act_ega = 0;
                if (total_capacity != 0) {
                    if (tar_ghi_wk != 0 || act_ghi_wk != 0) {
                        avg_tar_ghi = tar_ghi_wk / total_capacity;
                        avg_act_ghi = act_ghi_wk / total_capacity;
                    }
                   
                    if (tar_plf_wk != 0 || act_plf_wk != 0) {
                        avg_tar_plf = tar_plf_wk / total_capacity;
                        avg_act_plf = act_plf_wk / total_capacity;
                    }
                    if (tar_poa_wk != 0 || tar_poa_wk != 0) {
                        avg_tar_poa = tar_poa_wk / total_capacity;
                        avg_act_poa = act_poa_wk / total_capacity;
                    }
                    //avg_tar_gain = total_capTarGain / total_capacity;
                    //avg_tar_pr = total_capTarPr / total_capacity;
                    if (tar_ma_wk != 0 || act_ma_wk != 0) {
                        avg_tar_ma = tar_ma_wk / total_capacity;
                        avg_act_ma = act_ma_wk / total_capacity;
                    }
                    if (tar_iga_wk != 0 || act_iga_wk != 0) {
                        avg_tar_iga = tar_iga_wk / total_capacity;
                        avg_act_iga = act_iga_wk / total_capacity;
                    }
                    if (tar_ega_wk != 0 || act_ega_wk != 0) {
                        avg_tar_ega = tar_ega_wk / total_capacity;
                        avg_act_ega = act_ega_wk / total_capacity;
                    }
                   //avg_act_gain = total_capActGain / total_capacity;
                    //avg_act_pr = total_capActPr / total_capacity;
                }
                if (tar_energy_wk != 0) {
                    energy_var_wk = (((act_energy_wk - tar_energy_wk) / tar_energy_wk) * 100);
                }
                ghi_var_wk = (avg_act_ghi - avg_tar_ghi);
                poa_var_wk = (avg_act_poa - avg_tar_poa);
               //avg_pr_var = (avg_act_pr - avg_tar_pr);
               // avg_gain_var = (avg_act_gain - avg_tar_gain);
                plf_var_wk = (avg_act_plf - avg_tar_plf);
                ma_var_wk = (avg_act_ma - avg_tar_ma);
                iga_var_wk = (avg_act_iga - avg_tar_iga);
                ega_var_wk = (avg_act_ega - avg_tar_ega);

                //Energy 
                let en_pasitive;
                let en_negative;
                if (energy_var_wk < 0) {
                    en_negative = (energy_var_wk ).toFixed(1);
                }
                else {
                    en_pasitive = (energy_var_wk).toFixed(1);
                }
                
                diff_MUs_wk = (act_energy_wk - tar_energy_wk);
                Diff_Mus.push(diff_MUs_wk.toFixed(1));
                revenue.push(total_revenue_wk);
                actual_mu.push(act_energy_wk.toFixed(1));
                target_mu.push(tar_energy_wk.toFixed(1));
                var_mu_pos.push(en_pasitive);
                var_mu_neg.push(en_negative);

                let ghi_positive;
                let ghi_negative;
                if (ghi_var_wk < 0) {
                    ghi_negative = (ghi_var_wk).toFixed(1);
                }
                else {
                    ghi_positive = (ghi_var_wk).toFixed(1);
                }
                //Push GHI Weekly

                actual_ghi.push(avg_act_ghi.toFixed(1));
                target_ghi.push(avg_tar_ghi.toFixed(1));
                var_ghi_pos.push(ghi_positive);
                var_ghi_neg.push(ghi_negative);

                //POA
                
                let poa_positive;
                let poa_negative;
                if (poa_var_wk < 0) {
                    poa_negative = (poa_var_wk).toFixed(1);
                }
                else {
                    poa_positive = (poa_var_wk).toFixed(1);
                }
                
                actual_poa.push(avg_act_poa.toFixed(1));
                target_poa.push(avg_tar_poa.toFixed(1));
                var_poa_pos.push(poa_positive);
                var_poa_neg.push(poa_negative);
                
                //plf
                let plf_positive;
                let plf_negative;
                if (plf_var_wk < 0) {
                    plf_negative = plf_var_wk.toFixed(1);
                }
                else {
                    plf_positive = plf_var_wk.toFixed(1);
                }

                //Push PLF Weekly
                actual_plf.push(avg_act_plf.toFixed(1));
                target_plf.push(avg_tar_plf.toFixed(1));
                var_plf_pos.push(plf_positive);
                var_plf_neg.push(plf_negative);
                // MA Calcultion
                
                let ma_positive;
                let ma_negative;
                if (ma_var_wk < 0) {
                    ma_negative = ma_var_wk.toFixed(1);
                }
                else {
                    ma_positive = ma_var_wk.toFixed(1);
                }
                // Push Weekly MA
                actual_ma.push(avg_act_ma.toFixed(1));
                target_ma.push(avg_tar_ma.toFixed(1));
                var_ma_pos.push(ma_positive);
                var_ma_neg.push(ma_negative);


                let iga_positive;
                let iga_negative;
                if (iga_var_wk < 0) {
                    iga_negative = iga_var_wk.toFixed(1);
                }
                else {
                    iga_positive = iga_var_wk.toFixed(1);
                }
                // Push Weekly IGA
                actual_iga.push(avg_act_iga.toFixed(1));
                target_iga.push(avg_tar_iga.toFixed(1));
                var_iga_pos.push(iga_positive);
                var_iga_neg.push(iga_negative);

                //EGA Calculation
                
                let ega_positive;
                let ega_negative;
                if (ega_var_wk < 0) {
                    ega_negative = ega_var_wk.toFixed(1);
                }
                else {
                    ega_positive = ega_var_wk.toFixed(1);
                }
                // Push Weekly EGA
                actual_ega.push(avg_act_ega.toFixed(1));
                target_ega.push(avg_tar_ega.toFixed(1));
                var_ega_pos.push(ega_positive);
                var_ega_neg.push(ega_negative);


               
            }

        });
        GetOperationMonthlyPR();
        document.getElementById("loader").style.display = 'none';
        
    }

    function GetOperationMonthlyPR() {
        var tar_energy_mn= 0;
        var act_energy_mn = 0;
        var energy_var_mn = 0
        var tar_pr_mn = 0;
        var act_pr_mn = 0;
        var pr_var_mn = 0;
        var tar_ghi_mn = 0;
        var act_ghi_mn = 0;
        var pr_ghi_mn = 0;
        var tar_poa_mn = 0;
        var act_poa_mn = 0;
        var pr_poa_mn = 0;
        var tar_plf_mn = 0;
        var act_plf_mn = 0;
        var plf_var_mn = 0;
        var tar_ma_mn = 0;
        var act_ma_mn = 0;
        var ma_var_mn = 0;
        var tar_iga_mn = 0;
        var act_iga_mn = 0;
        var iga_var_mn = 0;
        var tar_ega_mn = 0;
        var act_ega_mn = 0;
        var ega_var_mn = 0;
        var total_revenue_mn = 0;
        var diff_MUs_mn = 0;
        var total_capacity_mn = 0;
        var total_tarriff_mn = 0;
        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var setDate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        //console.log(toDate);
        var monthdate = GetMonthDate(setDate);
        //console.log("Start Date :", monthdate.startdate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var fromDate = monthdate.startdate;
        var fy = fyear;//$('select#fy option:selected').val();
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetMontlyOperation", "SolarReport")' + '?fy=' + fy + '&fromDate=' + fromDate + '&toDate=' + toDate + '&site=' + site_ids + '&cnt=2',
            //url: "/WindReport/GetMontlyOperation?fy=" + fy + "&fromDate=" + fromDate + "&toDate=" + toDate + "&site=" + site_ids,
            contentType: "application/json; charset=utf-8",
            datatype: "html",
            success: function (result, status, xhr) {


                for (var i = 0; i < result.length; i++) {
                    total_capacity_mn += result[i].capacity;
                    tar_energy_mn += result[i].tar_kwh;
                    //total_expected_kwh += result[i].expected_kwh;
                    act_energy_mn += result[i].act_kwh;
                    //total_minr += minr;
                    total_tarriff_mn += result[i].total_tarrif;
                    tar_ghi_mn += result[i].tar_ghi * result[i].capacity;
                    act_ghi_mn += result[i].act_ghi * result[i].capacity;

                    tar_poa_mn += result[i].tar_poa * result[i].capacity;
                    act_poa_mn += result[i].act_poa * result[i].capacity;

                    tar_plf_mn += result[i].tar_plf * result[i].capacity;
                    act_plf_mn += result[i].act_plf * result[i].capacity;
                    //total_capTarPr += result[i].tar_pr * result[i].capacity;
                    //total_capTarGain += gain_tar * result[i].capacity;
                    tar_ma_mn += result[i].tar_ma * result[i].capacity;
                    act_ma_mn += result[i].act_ma * result[i].capacity;

                    tar_iga_mn += result[i].tar_iga * result[i].capacity;
                    act_iga_mn += result[i].act_iga * result[i].capacity;

                    tar_ega_mn += result[i].tar_ega * result[i].capacity;
                    act_ega_mn += result[i].act_ega * result[i].capacity;
                    total_revenue_mn += (result[i].act_kwh - result[i].tar_kwh) * result[i].total_tarrif;
                    //act_ma_wk += act_prval * result[i].capacity;
                    //total_capActGain += gain_act * result[i].capacity;
                }
                console.log("Target POA: " + tar_poa_mn);
                console.log("Act POA: " + act_poa_mn);
                let avg_t_var = 0;
                //let avg_e_var = (((avg_act_kwh - avg_expected_kwh) / avg_expected_kwh) * 100);
                let avg_tar_ghi = 0;
                let avg_ghi_var = 0;
                let avg_tar_plf = 0;
                let avg_plf_var = 0;
                let avg_tar_poa = 0;
                let avg_poa_var = 0;
                let avg_tar_gain = 0;
                let avg_gain_var = 0;
                let avg_tar_pr = 0;
                let avg_pr_var = 0;
                let avg_tar_ma = 0;
                let avg_ma_var = 0;
                let avg_tar_iga = 0;
                let avg_iga_var = 0;
                let avg_tar_ega = 0;
                let avg_ega_var = 0;
                let avg_act_ghi = 0
                let avg_act_poa = 0;
                let avg_act_plf = 0;
                let avg_act_gain = 0;
                let avg_act_pr = 0;
                let avg_act_ma = 0;
                let avg_act_iga = 0;
                let avg_act_ega = 0;
                if (total_capacity_mn != 0) {
                    if (tar_ghi_mn != 0 || act_ghi_mn != 0) {
                        avg_tar_ghi = tar_ghi_mn / total_capacity_mn;
                        avg_act_ghi = act_ghi_mn / total_capacity_mn;
                    }
                   
                    if (tar_plf_mn != 0 || act_plf_mn != 0) {
                        avg_tar_plf = tar_plf_mn / total_capacity_mn;
                        avg_act_plf = act_plf_mn / total_capacity_mn;
                    }
                    if (tar_poa_mn != 0 || act_poa_mn != 0) {

                        avg_tar_poa = tar_poa_mn / total_capacity_mn;
                        avg_act_poa = act_poa_mn / total_capacity_mn;
                        console.log("avg_tar_poa " + avg_tar_poa);
                        console.log("avg_act_poa " + avg_act_poa);
                        console.log("total_capacity_mn " + total_capacity_mn);
                    }
                    //avg_tar_gain = total_capTarGain / total_capacity;
                    //avg_tar_pr = total_capTarPr / total_capacity;
                    if (tar_ma_mn != 0 || act_ma_mn != 0) {
                        avg_tar_ma = tar_ma_mn / total_capacity_mn;
                        avg_act_ma = act_ma_mn / total_capacity_mn;
                    }
                    if (tar_iga_mn != 0 || act_iga_mn != 0) {
                        avg_tar_iga = tar_iga_mn / total_capacity_mn;
                        avg_act_iga = act_iga_mn / total_capacity_mn;
                    }
                    if (tar_ega_mn != 0 || act_ega_mn != 0) {
                        avg_tar_ega = tar_ega_mn / total_capacity_mn;
                        avg_act_ega = act_ega_mn / total_capacity_mn;
                    }
                    //avg_act_gain = total_capActGain / total_capacity;
                    //avg_act_pr = total_capActPr / total_capacity;
                }
                if (tar_energy_mn != 0) {
                    energy_var_mn = (((act_energy_mn - tar_energy_mn) / tar_energy_mn) * 100);
                }
                ghi_var_mn = (avg_act_ghi - avg_tar_ghi);
                poa_var_mn = (avg_act_poa - avg_tar_poa);
                //avg_pr_var = (avg_act_pr - avg_tar_pr);
                // avg_gain_var = (avg_act_gain - avg_tar_gain);
                plf_var_mn = (avg_act_plf - avg_tar_plf);
                ma_var_mn = (avg_act_ma - avg_tar_ma);
                iga_var_mn = (avg_act_iga - avg_tar_iga);
                ega_var_mn = (avg_act_ega - avg_tar_ega);

               
                revenue.push( total_revenue_mn );
                // Push Energy MU Monthly
                diff_MUs_mn = (act_energy_mn - tar_energy_mn);
                Diff_Mus.push(diff_MUs_mn.toFixed(1));

                //Energy 
                let en_pasitive;
                let en_negative;
                if (energy_var_mn < 0) {
                    en_negative = (energy_var_mn).toFixed(1);
                }
                else {
                    en_pasitive = (energy_var_mn).toFixed(1);
                }


                actual_mu.push(act_energy_mn.toFixed(1));
                target_mu.push(tar_energy_mn.toFixed(1));
                var_mu_pos.push(en_pasitive);
                var_mu_neg.push(en_negative);

                let ghi_positive;
                let ghi_negative;
                if (ghi_var_mn < 0) {
                    ghi_negative = (ghi_var_mn).toFixed(1);
                }
                else {
                    ghi_positive = (ghi_var_mn).toFixed(1);
                }
                //Push GHI Weekly

                actual_ghi.push(avg_act_ghi.toFixed(1));
                target_ghi.push(avg_tar_ghi.toFixed(1));
                var_ghi_pos.push(ghi_positive);
                var_ghi_neg.push(ghi_negative);

                //POA

                let poa_positive;
                let poa_negative;
                if (poa_var_mn < 0) {
                    poa_negative = (poa_var_mn).toFixed(1);
                }
                else {
                    poa_positive = (poa_var_mn).toFixed(1);
                }

                actual_poa.push(avg_act_poa.toFixed(1));
                target_poa.push(avg_tar_poa.toFixed(1));
                var_poa_pos.push(poa_positive);
                var_poa_neg.push(poa_negative);

                //plf
                let plf_positive;
                let plf_negative;
                if (plf_var_mn < 0) {
                    plf_negative = plf_var_mn.toFixed(1);
                }
                else {
                    plf_positive = plf_var_mn.toFixed(1);
                }

                //Push PLF Weekly
                actual_plf.push(avg_act_plf.toFixed(1));
                target_plf.push(avg_tar_plf.toFixed(1));
                var_plf_pos.push(plf_positive);
                var_plf_neg.push(plf_negative);
                // MA Calcultion

                let ma_positive;
                let ma_negative;
                if (ma_var_mn < 0) {
                    ma_negative = ma_var_mn.toFixed(1);
                }
                else {
                    ma_positive = ma_var_mn.toFixed(1);
                }
                // Push Weekly MA
                actual_ma.push(avg_act_ma.toFixed(1));
                target_ma.push(avg_tar_ma.toFixed(1));
                var_ma_pos.push(ma_positive);
                var_ma_neg.push(ma_negative);


                let iga_positive;
                let iga_negative;
                if (iga_var_mn < 0) {
                    iga_negative = iga_var_mn.toFixed(1);
                }
                else {
                    iga_positive = iga_var_mn.toFixed(1);
                }
                // Push Weekly IGA
                actual_iga.push(avg_act_iga.toFixed(1));
                target_iga.push(avg_tar_iga.toFixed(1));
                var_iga_pos.push(iga_positive);
                var_iga_neg.push(iga_negative);

                //EGA Calculation

                let ega_positive;
                let ega_negative;
                if (ega_var_mn < 0) {
                    ega_negative = ega_var_mn.toFixed(1);
                }
                else {
                    ega_positive = ega_var_mn.toFixed(1);
                }
                // Push Weekly EGA
                actual_ega.push(avg_act_ega.toFixed(1));
                target_ega.push(avg_tar_ega.toFixed(1));
                var_ega_pos.push(ega_positive);
                var_ega_neg.push(ega_negative);

               

                GetOperationYearlyPR();  // Call function for get yearly data
            }
        });
    }
    function GetOperationYearlyPR() {

        var tar_energy_yr = 0;
        var act_energy_yr = 0;
        var energy_var_yr = 0
        var tar_pr_yr = 0;
        var act_pr_yr = 0;
        var pr_var_yr = 0;
        var tar_ghi_yr = 0;
        var act_ghi_yr = 0;
        var pr_ghi_yr = 0;
        var tar_poa_yr = 0;
        var act_poa_yr = 0;
        var pr_poa_yr = 0;
        var tar_plf_yr = 0;
        var act_plf_yr = 0;
        var plf_var_yr = 0;
        var tar_ma_yr = 0;
        var act_ma_yr = 0;
        var ma_var_yr = 0;
        var tar_iga_yr = 0;
        var act_iga_yr = 0;
        var iga_var_yr = 0;
        var tar_ega_yr = 0;
        var act_ega_yr = 0;
        var ega_var_yr = 0;
        var total_revenue_yr = 0;
        var diff_MUs_yer = 0;
        var total_capacity_yr = 0;
        var total_tarriff_yr = 0;
        var fy = fyear;//$('select#fy option:selected').val();
        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var FyDate = getFinancialYearDate(fy);
        var FyDate1 = FyDate.startdate;
        const fydateArr = FyDate1.split("-");
        var fromDate = `${fydateArr[2]}-${fydateArr[1]}-${fydateArr[0]}`;
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetYearlyOperation", "SolarReport")' + '?fy=' + fy + '&fromDate=' + fromDate + '&toDate=' + toDate + '&site=' + site_ids + '&cnt=3',
            //url: "/WindReport/GetMontlyOperation?fy=" + fy + "&fromDate=" + fromDate + "&toDate=" + toDate + "&site=" + site_ids,
            contentType: "application/json; charset=utf-8",
            datatype: "html",
            success: function (result, status, xhr) {


                for (var i = 0; i < result.length; i++) {
                    total_capacity_yr += result[i].capacity;
                    tar_energy_yr += result[i].tar_kwh;
                    //total_expected_kwh += result[i].expected_kwh;
                    act_energy_yr += result[i].act_kwh;
                    //total_minr += minr;
                    total_tarriff_yr += result[i].total_tarrif;
                    tar_ghi_yr += result[i].tar_ghi * result[i].capacity;
                    act_ghi_yr += result[i].act_ghi * result[i].capacity;

                    tar_poa_yr += result[i].tar_poa * result[i].capacity;
                    act_poa_yr += result[i].act_poa * result[i].capacity;

                    tar_plf_yr += result[i].tar_plf * result[i].capacity;
                    act_plf_yr += result[i].act_plf * result[i].capacity;
                    //total_capTarPr += result[i].tar_pr * result[i].capacity;
                    //total_capTarGain += gain_tar * result[i].capacity;
                    tar_ma_yr += result[i].tar_ma * result[i].capacity;
                    act_ma_yr += result[i].act_ma * result[i].capacity;

                    tar_iga_yr += result[i].tar_iga * result[i].capacity;
                    act_iga_yr += result[i].act_iga * result[i].capacity;

                    tar_ega_yr += result[i].tar_ega * result[i].capacity;
                    act_ega_yr += result[i].act_ega * result[i].capacity;
                    total_revenue_yr += (result[i].act_kwh - result[i].tar_kwh) * result[i].total_tarrif;
                    //act_ma_wk += act_prval * result[i].capacity;
                    //total_capActGain += gain_act * result[i].capacity;
                }
                let avg_t_var = 0;
                //let avg_e_var = (((avg_act_kwh - avg_expected_kwh) / avg_expected_kwh) * 100);
                let avg_tar_ghi = 0;
                let avg_ghi_var = 0;
                let avg_tar_plf = 0;
                let avg_plf_var = 0;
                let avg_tar_poa = 0;
                let avg_poa_var = 0;
                let avg_tar_gain = 0;
                let avg_gain_var = 0;
                let avg_tar_pr = 0;
                let avg_pr_var = 0;
                let avg_tar_ma = 0;
                let avg_ma_var = 0;
                let avg_tar_iga = 0;
                let avg_iga_var = 0;
                let avg_tar_ega = 0;
                let avg_ega_var = 0;
                let avg_act_ghi = 0
                let avg_act_poa = 0;
                let avg_act_plf = 0;
                let avg_act_gain = 0;
                let avg_act_pr = 0;
                let avg_act_ma = 0;
                let avg_act_iga = 0;
                let avg_act_ega = 0;
                if (total_capacity_yr != 0) {
                    if (tar_ghi_yr != 0 || act_ghi_yr != 0) {
                        avg_tar_ghi = tar_ghi_yr / total_capacity_yr;
                        avg_act_ghi = act_ghi_yr / total_capacity_yr;
                    }
                   
                    if (tar_plf_yr != 0 || act_plf_yr != 0) {
                        avg_tar_plf = tar_plf_yr / total_capacity_yr;
                        avg_act_plf = act_plf_yr / total_capacity_yr;
                    }
                    if (tar_poa_yr != 0 || act_poa_yr != 0) {
                        avg_tar_poa = tar_poa_yr / total_capacity_yr;
                        avg_act_poa = act_poa_yr / total_capacity_yr;
                    }
                    //avg_tar_gain = total_capTarGain / total_capacity;
                    //avg_tar_pr = total_capTarPr / total_capacity;
                    if (tar_ma_yr != 0 || act_ma_yr != 0) {
                        avg_tar_ma = tar_ma_yr / total_capacity_yr;
                        avg_act_ma = act_ma_yr / total_capacity_yr;
                    }
                    if (tar_iga_yr != 0 || act_iga_yr != 0) {
                        avg_tar_iga = tar_iga_yr / total_capacity_yr;
                        avg_act_iga = act_iga_yr / total_capacity_yr;
                    }
                    if (tar_ega_yr != 0 || act_ega_yr != 0) {
                        avg_tar_ega = tar_ega_yr / total_capacity_yr;
                        avg_act_ega = act_ega_yr / total_capacity_yr;
                    }
                    //avg_act_gain = total_capActGain / total_capacity;
                    //avg_act_pr = total_capActPr / total_capacity;
                }
                if (tar_energy_yr != 0) {
                    energy_var_yr = (((act_energy_yr - tar_energy_yr) / tar_energy_yr) * 100);
                }
                ghi_var_yr = (avg_act_ghi - avg_tar_ghi);
                poa_var_yr = (avg_act_poa - avg_tar_poa);
                //avg_pr_var = (avg_act_pr - avg_tar_pr);
                // avg_gain_var = (avg_act_gain - avg_tar_gain);
                plf_var_yr = (avg_act_plf - avg_tar_plf);
                ma_var_yr = (avg_act_ma - avg_tar_ma);
                iga_var_yr = (avg_act_iga - avg_tar_iga);
                ega_var_yr = (avg_act_ega - avg_tar_ega);


                //Energy 
                let en_pasitive;
                let en_negative;
                if (energy_var_yr < 0) {
                    en_negative = (energy_var_yr).toFixed(1);
                }
                else {
                    en_pasitive = (energy_var_yr).toFixed(1);
                }
                
                revenue.push(total_revenue_yr);
                // Push Energy MU Monthly
                diff_MUs_yr = (act_energy_yr - tar_energy_yr);
                Diff_Mus.push(diff_MUs_yr.toFixed(1));

                actual_mu.push(act_energy_yr.toFixed(1));
                target_mu.push(tar_energy_yr.toFixed(1));
                var_mu_pos.push(en_pasitive);
                var_mu_neg.push(en_negative);

                let ghi_positive;
                let ghi_negative;
                if (ghi_var_yr < 0) {
                    ghi_negative = (ghi_var_yr).toFixed(1);
                }
                else {
                    ghi_positive = (ghi_var_yr).toFixed(1);
                }
                //Push GHI Weekly

                actual_ghi.push(avg_act_ghi.toFixed(1));
                target_ghi.push(avg_tar_ghi.toFixed(1));
                var_ghi_pos.push(ghi_positive);
                var_ghi_neg.push(ghi_negative);

                //POA

                let poa_positive;
                let poa_negative;
                if (poa_var_mn < 0) {
                    poa_negative = (poa_var_yr).toFixed(1);
                }
                else {
                    poa_positive = (poa_var_yr).toFixed(1);
                }

                actual_poa.push(avg_act_poa.toFixed(1));
                target_poa.push(avg_tar_poa.toFixed(1));
                var_poa_pos.push(poa_positive);
                var_poa_neg.push(poa_negative);

                //plf
                let plf_positive;
                let plf_negative;
                if (plf_var_yr < 0) {
                    plf_negative = plf_var_yr.toFixed(1);
                }
                else {
                    plf_positive = plf_var_yr.toFixed(1);
                }

                //Push PLF Weekly
                actual_plf.push(avg_act_plf.toFixed(1));
                target_plf.push(avg_tar_plf.toFixed(1));
                var_plf_pos.push(plf_positive);
                var_plf_neg.push(plf_negative);
                // MA Calcultion

                let ma_positive;
                let ma_negative;
                if (ma_var_yr < 0) {
                    ma_negative = ma_var_yr.toFixed(1);
                }
                else {
                    ma_positive = ma_var_yr.toFixed(1);
                }
                // Push Weekly MA
                actual_ma.push(avg_act_ma.toFixed(1));
                target_ma.push(avg_tar_ma.toFixed(1));
                var_ma_pos.push(ma_positive);
                var_ma_neg.push(ma_negative);


                let iga_positive;
                let iga_negative;
                if (iga_var_yr < 0) {
                    iga_negative = iga_var_yr.toFixed(1);
                }
                else {
                    iga_positive = iga_var_yr.toFixed(1);
                }
                // Push Weekly IGA
                actual_iga.push(avg_act_iga.toFixed(1));
                target_iga.push(avg_tar_iga.toFixed(1));
                var_iga_pos.push(iga_positive);
                var_iga_neg.push(iga_negative);

                //EGA Calculation

                let ega_positive;
                let ega_negative;
                if (ega_var_yr < 0) {
                    ega_negative = ega_var_yr.toFixed(1);
                }
                else {
                    ega_positive = ega_var_yr.toFixed(1);
                }
                // Push Weekly EGA
                actual_ega.push(avg_act_ega.toFixed(1));
                target_ega.push(avg_tar_ega.toFixed(1));
                var_ega_pos.push(ega_positive);
                var_ega_neg.push(ega_negative);
                // Call Cahrd Functions
                //console.log("Actual MU" + actual_mu);
                //console.log("target_mu" + target_mu);
                //console.log("var_mu_pos" + var_mu_pos);
                //console.log("var_mu_neg" + var_mu_neg);

                //console.log("actual_poa" + actual_poa);
                //console.log("target_poa" + target_poa);
                //console.log("var_poa_pos" + var_poa_pos);
                //console.log("var_poa_neg" + var_poa_neg);

                //console.log("actual_plf" + actual_plf);
                //console.log("target_plf" + target_plf);
                //console.log("var_plf_pos" + var_plf_pos);
                //console.log("var_plf_neg" + var_plf_neg);

                //console.log("actual_ma" + actual_ma);
                //console.log("target_ma" + target_ma);
                //console.log("var_ma_pos" + var_ma_pos);
                //console.log("var_ma_neg" + var_ma_neg);

                //console.log("actual_iga" + actual_iga);
                //console.log("target_iga" + target_iga);
                //console.log("var_iga_pos" + var_iga_pos);
                //console.log("var_iga_neg" + var_iga_neg);

                //console.log("actual_ega" + actual_ega);
                //console.log("target_ega" + target_ega);
                //console.log("var_ega_pos" + var_ega_pos);
                //console.log("var_ega_neg" + var_ega_neg);
                chartEnergyMU(actual_mu, target_mu, var_mu_pos, var_mu_neg);
                chartIR(actual_poa, target_poa, var_poa_pos, var_poa_neg);
                PLF_chart(actual_plf, target_plf, var_plf_pos, var_plf_neg);
                MA_chart(actual_ma, target_ma, var_ma_pos, var_ma_neg);
                IGA_chart(actual_iga, target_iga, var_iga_pos, var_iga_neg);
                EGA_chart(actual_ega, target_ega, var_ega_pos, var_ega_neg);

                OperationalTable(Diff_Mus, revenue);
            }
        });

    }
    function OperationalTable(Diff_Mus, revenue) {
        var wind_side = "@Html.Raw(windSiteList.TrimEnd(','))";
        const site_array = wind_side.split(",");
        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var seldate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        var fromDate = GetWeeklyDays(seldate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
         $.ajax({
            type: "GET",
           // url: "/WindReport/GetSPVList?state=" + val,
             url: '@Url.Action("GetOperationHeadData", "SolarReport")' + '?site=' + wind_side,
            contentType: "application/json; charset=utf-8",
            //data: '{"state":"' + val + '"}',
             datatype: "html",

             success: function (result, status, xhr) {
                 var sec1 = "";
                 var sec2 = "";
                 var sec3 = "";
                 sec1 += '<p>&nbsp</p><h4 class="dark-blue" style="font-weight: bold;">HFE Operational Performance</h4>';
                 //sec1 += '<p class="dark-blue" style="font-weight: bold;">(' + fromDate + ' to ' + toDate + ')</p>';

                 sec2 += '<table class="table table-bordered table-striped">';
                 sec2 += '<thead class="tbl-head"><tr>';
                 sec2 += '<th colspan="2"></th></tr><thead>';
                 sec2 += '<tr><td>Portfolio</td><td style="text-align: right;">' + site_array.length + '</td></tr>';
                 sec2 += '<tr><td>SPVs</td><td style="text-align: right;">' + result[0].spv_count + '</td></tr>';
                 sec2 += '<tr><td>Capacity (in MW)</td><td style="text-align: right;">' + result[0].capacity.toFixed(0) + '</td></tr>';
                 sec2 += '</table>';


                 sec3 += '<table class="table table-bordered table-striped" style="line-height: 15px;">';
                 sec3 += '<thead class="tbl-head"><tr>';
                 sec3 += '<th>Period</th><th>Energy Gain/Loss (MUs)	</th><th>Revenue(MINR)</th></tr ></thead> ';
                 sec3 += '<tr><td>WK</td><td style="text-align: right;">' + Diff_Mus[0] + '</td><td style="text-align: right;">' + revenue[0].toFixed(1) + '</td></tr>';
                 sec3 += '<tr><td>MTD</td><td style="text-align: right;">' + Diff_Mus[1] + '</td><td style="text-align: right;">' + revenue[1].toFixed(1) + '</td></tr>';
                 sec3 += '<tr><td>YTD</td><td style="text-align: right;">' + Diff_Mus[2] + '</td><td style="text-align: right;">' + revenue[2].toFixed(1) + '</td></tr></table>';

                 $("#wk_head_sec1").html(sec1);
                 $("#wk_head_sec2").html(sec2);
                 $("#wk_head_sec3").html(sec3);

                 //document.getElementById('spv_counts').innerHTML = result[0].spv_count;
                //document.getElementById('capacity').innerHTML = result[0].capacity.toFixed(0);

            }
         });

        //document.getElementById('portfolio').innerHTML = site_array.length;
        document.getElementById('wk_head').style.display = 'flex';
    }
    function chartEnergyMU(actual_mu, target_mu, var_mu_pos, var_mu_neg) {

        let chartStatus = Chart.getChart("energy_mu_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        new Chart(document.getElementById("energy_mu_chart"), {
            type: 'bar',
            data: {
                labels: ["WK","MTD","YTD"],
                datasets: [{
                    yAxisID: 'en_mu',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_mu,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'en_mu',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_mu,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                    }, {
                    yAxisID: 'mu_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_mu_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }, {
                    yAxisID: 'mu_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_mu_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Energy(MUs)",

                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    en_mu: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    mu_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }
    //Wind Spped Chart
    function chartIR(actual_wind, target_wind, var_wind_pos, var_wind_neg) {
        let chartStatus = Chart.getChart("wind_sp_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        new Chart(document.getElementById("wind_sp_chart"), {
            type: 'bar',
            data: {
                labels: ["WK", "MTD", "YTD"],
                datasets: [{
                    yAxisID: 'ir_en',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ir_en',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ir_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_wind_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }, {
                    yAxisID: 'ir_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_wind_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Irradiance (kWh/m^2)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    ir_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    ir_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }

    //PLF Chart
    function PLF_chart(actual_plf, target_plf, var_plf_pos, var_plf_neg) {
        let chartStatus = Chart.getChart("plf_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        new Chart(document.getElementById("plf_chart"), {
            type: 'bar',
            data: {
                labels: ["WK", "MTD", "YTD"],
                datasets: [{
                    yAxisID: 'plf_en',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_plf,
                    order: 1,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }, {
                    yAxisID: 'plf_en',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_plf,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'plf_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_plf_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }, {
                    yAxisID: 'plf_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_plf_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "PLF (%)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    plf_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    plf_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }
    //MA  Chart
    function MA_chart(actual_ma, target_ma, var_ma_pos, var_ma_neg) {
        let chartStatus = Chart.getChart("ma_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        new Chart(document.getElementById("ma_chart"), {
            type: 'bar',
            data: {
                labels: ["WK", "MTD", "YTD"],
                datasets: [{
                    yAxisID: 'ma_en',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_ma,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ma_en',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_ma,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                },{
                    yAxisID: 'ma_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_ma_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ma_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_ma_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "MA (%)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    ma_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    ma_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }
    //IGA  Chart
    function IGA_chart(actual_iga, target_iga, var_iga_pos, var_iga_neg) {
        let chartStatus = Chart.getChart("iga_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        new Chart(document.getElementById("iga_chart"), {
            type: 'bar',
            data: {
                labels: ["WK", "MTD", "YTD"],
                datasets: [{
                    yAxisID: 'iga_en',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_iga,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'iga_en',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_iga,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                    }, {
                    yAxisID: 'iga_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_iga_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                    }, {
                    yAxisID: 'iga_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_iga_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "IGA (%)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    iga_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    iga_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }
    //EGA  Chart
    function EGA_chart(actual_ega, target_ega, var_ega_pos, var_ega_neg) {
        let chartStatus = Chart.getChart("ega_chart"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        new Chart(document.getElementById("ega_chart"), {
            type: 'bar',
            data: {
                labels: ["WK", "MTD", "YTD"],
                datasets: [{
                    yAxisID: 'ega_en',
                    label: "Target",
                    type: "bar",
                    borderColor: "#77CAE7",
                    backgroundColor: "#77CAE7",
                    data: target_ega,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ega_en',
                    label: "Actual",
                    type: "bar",
                    borderColor: "#31576D",
                    backgroundColor: "#31576D",
                    data: actual_ega,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'ega_var',
                    label: "(-ve) %",
                    type: "bubble",
                    backgroundColor: "#EE403D",
                    borderColor: "#EE403D",
                    data: var_ega_neg,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }, {
                    yAxisID: 'ega_var',
                    label: "(+ve) %",
                    type: "bubble",
                    backgroundColor: "#86C466",
                    borderColor: "#86C466",
                    backgroundColorHover: "#3e95cd",
                    data: var_ega_pos,
                    fill: false,
                    order: 0,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "EGA (%)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    ega_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    ega_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        //ticks: { beginAtZero: true, },
                        grid: { display: false }
                    },
                }
            }

        });
    }
   // -----------------------------------Weekly ---------------------//
    function MajorBreakdown() {
        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var seldate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        var fromDate = GetWeeklyDays(seldate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var fyear1 = fyear; //$('select#fy option:selected').val();
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";

        $.ajax({
            type: "GET",
            url: '@Url.Action("GetSolarMajorBreakdown", "SolarReport")' + '?fy=' + fyear1 + '&fromDate=' + fromDate + '&toDate=' + toDate + '&site=' + site_ids,
            //url: "/WindReport/GetWindPRReportSPVWise?fy=" + fyear + " &fromDate=" + fromDate + "&toDate=" + toDate,
            contentType: "application/json; charset=utf-8",

            datatype: "JSON",
            success: function (result, status, xhr) {
                //console.log(result);
                var tbl = '<table id="example2"  class="table table-bordered table-striped" >';
                var totalstop = 0;
                var ICR_count = 0;
                var errorDesc = "";

                var hours = 0;
                var minutes = 0;
                var seconds = 0;
                var bdType = "";
                var date1 = "";
                var site = "";
                var errorDesc = "";

                var isGreaterThanThirty = false;

                tbl += '<thead class="tbl-head"><tr>';
                tbl += '<th>Date</th>';
                tbl += '<th>Site</th>';
                tbl += '<th>Location</th>';
                tbl += '<th>BD Type</th>';
                tbl += '<th>Total Stop</th>';
                tbl += '<th>Reason of Breakdown</th>';
                tbl += '</tr></thead>';
                if (result.length > 0) {
                    //var total_time = "";
                    for (var i = 0; i < result.length; i++) {
                       // console.log(result[i].from_bd.totalSeconds);
                        var start_time = toHoursAndMinutes(result[i].from_bd.totalSeconds);
                        var stop_time = toHoursAndMinutes(result[i].to_bd.totalSeconds);
                        var total_time = toHoursAndMinutes(result[i].total_bd.totalSeconds);
                        //console.log("Total Time using tohoursandminutes function :", total_time, "Type of :-", typeof (total_time));
                        //console.log(result[i].bd_type, "type of ", typeof (result[i].bd_type));

                        if (total_time.split(":")[1] >= 30 || total_time.split(":")[0] > 0) {
                            isGreaterThanThirty = true;
                        }

                        if (result[i].bd_type_id == 1 || result[i].bd_type_id == 2) {
                            //console.log("Hello BD type is ", result[i].bd_type);
                            if (total_time.split(":")[1] >= 30 || total_time.split(":")[0] > 0) {
                                tbl += '<tr>';
                                tbl += '<td class="text-left">' + result[i].date + '</td>';
                                tbl += '<td class="text-left">' + result[i].site + '</td>';
                                location_name = "Plant Shutdown";
                                //if (result[i].icr) {
                                //location_name = result[i].icr + "/" + result[i].inv;
                                //}

                                //tbl += '<td class="text-left">' + result[i].inv_cnt + ' Icr/Inv </td>';
                                tbl += '<td class="text-left">' + result[i].icr + '/' + result[i].inv+'</td>';
                                tbl += '<td class="text-left">' + result[i].bd_type + '</td>';
                                //tbl += '<td class="text-left">' + start_time + ' to ' + stop_time + ' = ' + total_time + '</td>';
                                tbl += '<td class="text-left">' + total_time + '</td>';
                                tbl += '<td class="text-left">' + result[i].bd_remarks + '</td>';
                            }
                            else {
                                //console.log(result[i].total_stop.split(":")[1], "Is less than 30");
                                var tem = i - 1;
                                //console.log(tem, result[tem]);
                            }
                        }
                        else {

                            if (total_time.split(":")[1] >= 30 || total_time.split(":")[0] > 0) {
                                date1 = result[i].date;
                                site = result[i].site;
                                errorDesc = result[i].bd_remarks;
                                bdType = result[i].bd_type;
                                var totalstop = toHoursAndMinutes(result[i].total_bd.totalSeconds);
                                var date = "";
                                var stopfrom = "";
                                var stopto = "";
                                var sumDone = false;
                                var count = 0;
                                if (i == 0  &&  i < result.length) {
                                    count = i + 1;
                                } else {
                                    count = i;
                                }
                                if (result[i].site_id == result[count].site_id) {
                                    if (i > 0) {
                                        date = result[i - 1].date;
                                        stopfrom = result[i - 1].from_bd;
                                        stopto = result[i - 1].to_bd;
                                       
                                    }
                                    if (i >= 0) {
                                        if (isGreaterThanThirty && date == result[i].date && stopfrom == result[i].from_bd && stopto == result[i].to_bd) {
                                            ICR_count += 1;
                                            hours += Number((total_time.split(":")[0]).toString());
                                            minutes += Number((total_time.split(":")[1]).toString());
                                            seconds += Number((total_time.split(":")[2]).toString);
                                            //var start_time = toHoursAndMinutes(result[i].from_bd.totalSeconds);
                                            // var stop_time = toHoursAndMinutes(result[i].to_bd.totalSeconds);

                                            //console.log("Hello here", "Type Of :", typeof (total_time.split(":")[1]), "number ", parseInt(total_time.split(":")[0]), parseInt(total_time.split(":")[1]));
                                            //console.log("Hours", hours, "Minutes", minutes, "Seconds: ", seconds);
                                            totalstop += totalstop;
                                            if (result[i].stop_from != result[i + 1].stop_to || result[i].stop_to != result[i + 1].stop_to) {
                                                sumDone = true;
                                            }
                                        }
                                        else {
                                            totalstop = toHoursAndMinutes(result[i].total_bd.totalSeconds);
                                        }
                                    }
                                    }
                                    
                            }
                            //console.log("Date : " + date1 + "totalstop :" + totalstop);
                            tbl += '<tr>';
                            tbl += '<td class="text-left">' + date1 + '</td>';
                            tbl += '<td class="text-left">' + site + '</td>';
                            location_name = "Plant Shutdown";
                            //if (result[i].icr) {
                            //location_name = result[i].icr + "/" + result[i].inv;
                            //}

                            tbl += '<td class="text-left">' + ICR_count + ' ICR/INV </td>';
                            tbl += '<td class="text-left">' + bdType + '</td>';
                            //tbl += '<td class="text-left">' + start_time + ' to ' + stop_time + ' = ' + total_time + '</td>';
                            tbl += '<td class="text-left">' + totalstop + '</td>';
                            tbl += '<td class="text-left">' + errorDesc + '</td>';
                        }
                        if (total_time.split(":")[1] >= 30 ) {
                            
                        }
                        //var formattedDate = moment(result[i].date, 'YYYY/MM/DD').format('DD-MM-YYYY');
                        
                    }
                }
                else {
                    //console.log("Data not available");
                    // tbl += '<tr><th colspan="12" style="text-align:center">Data Not Available <th></tr>';
                }
                tbl += '</table>';
                //$("#reportsDaily1").html("").html(tbl);
                $("#reportsMonthly").html("").html(tbl);
                $.fn.DataTable.ext.pager.numbers_length = 6;
                $('#example2').DataTable({
                    dom: 'Bfrtip',
                    title: 'ImportApproval',
                    responsive: false,
                    lengthChange: false,
                    autoWidth: false,
                    paging: true,
                    searching: true,
                    ordering: true,
                    info: true,
                    autoWidth: false,
                    buttons: [
                        {
                            extend: 'excel',
                            title: 'WTG Wise Monthly Generation Report',
                            exportOptions: {
                                columns: ':visible'
                            }
                        },
                        {
                            extend: 'csv',
                            title: 'WTG Wise Monthly Generation Report',
                            exportOptions: {
                                columns: ':visible'
                            }
                        },
                        'colvis'
                    ]
                    /* "buttons": [
                         'copy', 'excel', 'csv', 'colvis'
                     ]*/
                });
                $(".dt-buttons").addClass('btn-group flex-wrap');
                $(".dt-buttons > button").addClass('btn btn-secondary');
                $(".dataTables_filter> label >input").addClass('form-control form-control-sm');
                $('#example2').removeClass('dataTable');
            }
        });

    }


    // Mothly Report WTG Wise

    function GetPerformanceBySPV() {

        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var seldate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        var fromDate = GetWeeklyDays(seldate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var fyear1 = fyear;//$('select#fy option:selected').val();
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";
        var actual_energy = [];
        var target_energy = [];
        var pas_energy_var = [];
        var neg_energy_var = [];

        var actual_pr = [];
        var target_pr = [];
        var pas_pr_var = [];
        var neg_pr_var = [];
        var Levels = [];

        var revenue_arr = [];
        var reporthead = "SPV Wise Reports";
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetSolarPRReportSPVWise", "SolarReport")' + '?fy=' + fyear1 + '&fromDate=' + fromDate + '&toDate=' + toDate + '&sitelist=' + site_ids,
            //url: "/WindReport/GetWindPRReportSPVWise?fy=" + fyear + " &fromDate=" + fromDate + "&toDate=" + toDate,
            contentType: "application/json; charset=utf-8",

            datatype: "JSON",
            success: function (result, status, xhr) {
               // console.log(result);
                //var tbl = '<div class="text-center"><h5>' + reporthead+'</h5></div>';

                var tbl = '<table id="example3"  class="table table-bordered table-striped" style="width:150%">';
                tbl += '<thead class="tbl-head"><tr>';
                tbl += '<th rowspan="2">SPV</th><th  rowspan="2">Capacity <br>(MW)</th>';
                tbl += '<th colspan="3" class="text-center">Gen nos.(MUs)</th><th>Revenue</th>';
                tbl += '<th colspan="3" class="text-center">GHI (kWh/m<sup>2</sup>)</th><th colspan="3" class="text-center">POA (kWh/m<sup>2</sup>)</th><th colspan="3" class="text-center">GHI Vs POA Gain (%)</th>';
                tbl += '<th colspan="3" class="text-center">PLF (%)</th>';
                tbl += '<th colspan="3" class="text-center">PR (%)</th>';
                tbl += '<th colspan="3" class="text-center">MA Actual (%)</th><th colspan="3" class="text-center">IGA (%)</th>';
                tbl += '<th colspan="3" class="text-center">EGA (%)</th></tr>';
                // tbl += '<tr><th>&nbsp;</th>';

                tbl += '<tr><th>Tar</th>';
                tbl += '<th>Act JMR</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>(MINR)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '</tr></thead>';


                if (result.length > 0) {
                    //console.log("Datatable");
                    let total_capacity = 0;
                    let total_tar_kwh = 0;
                    let total_act_kwh = 0;
                    // let total_expected_kwh = 0;
                    let total_revenue = 0;
                    let total_capTarGhi = 0;
                    let total_tar_ghi = 0;
                    let total_act_ghi = 0;
                    let total_capTarPlf = 0;
                    let total_tar_plf = 0;
                    let total_act_plf = 0;
                    let total_capTarGain = 0;
                    let total_tar_gain = 0;
                    let total_act_gain = 0;
                    let total_capTarPoa = 0;
                    let total_tar_poa = 0;
                    let total_act_poa = 0;
                    let total_capTarPr = 0;
                    let total_tar_pr = 0;
                    let total_act_pr = 0;
                    let total_capTarMa = 0;
                    let total_tar_ma = 0;
                    let total_act_ma = 0;
                    let total_capTarIga = 0;
                    let total_tar_iga = 0;
                    let total_act_iga = 0;
                    let total_capTarEga = 0;
                    let total_tar_ega = 0;
                    let total_act_ega = 0;
                    let total_capActGhi = 0;
                    let total_capActPlf = 0;
                    let total_capActGain = 0;
                    let total_capActPoa = 0;
                    let total_capActPr = 0;
                    let total_capActMa = 0;
                    let total_capActIga = 0;
                    let total_capActEga = 0;


                    for (var i = 0; i < result.length; i++) {
                        Levels.push(result[i].spv);
                        let revenue = 0;
                        let jmr_var = 0;
                        let plf_var = 0;
                        let ma_act_var = 0;
                        let iga_var = 0;
                        let ega_var = 0;
                        revenue = (result[i].act_jmr_kwh_mu - result[i].tar_kwh_mu) * result[i].total_tarrif;
                        let ghi_var = 0;
                        let poa_var = 0;
                        let pr_var = 0;
                        let gain_tar = 0;
                        let gain_act = 0;
                        let gain_var = 0;
                        let act_prval = 0;

                        revenue = (result[i].act_kwh - result[i].tar_kwh) * result[i].total_tarrif;
                        if (result[i].act_kwh != 0 || result[i].tar_kwh != 0) {
                            jmr_var = ((result[i].act_kwh - result[i].tar_kwh) / result[i].tar_kwh) * 100;
                        }
                        if (result[i].expected_kwh == 0 || result[i].act_kwh == 0) {
                            act_prval = 0;
                        }
                        else {
                            act_prval = (result[i].act_kwh / result[i].expected_kwh) * 100;
                        }
                        if (result[i].tar_ghi != 0) {
                            ghi_var = ((result[i].act_ghi.toFixed(2) - result[i].tar_ghi.toFixed(2)) / result[i].tar_ghi.toFixed(2)) * 100;
                        }
                        if (result[i].tar_poa != 0) {
                            poa_var = ((result[i].act_poa.toFixed(2) - result[i].tar_poa.toFixed(2)) / result[i].tar_poa.toFixed(2)) * 100;
                        }
                        
                        pr_var = (act_prval - result[i].tar_pr);
                        plf_var = (result[i].act_plf - result[i].tar_plf);
                        ma_act_var = (result[i].act_ma - result[i].tar_ma);
                        iga_var = (result[i].act_iga - result[i].tar_iga);
                        ega_var = (result[i].act_ega - result[i].tar_ega);

                       
                        if (result[i].tar_poa == 0 || result[i].tar_ghi == 0) {
                            gain_tar = 0;
                        } else {
                            gain_tar = (result[i].tar_poa / result[i].tar_ghi) * 100;
                        }
                        if (result[i].act_poa == 0 || result[i].act_ghi == 0) {
                            gain_act = 0;
                        } else {
                            gain_act = (result[i].act_poa / result[i].act_ghi) * 100;
                        }
                        if (gain_act == 0 || gain_tar == 0) {
                            gain_var = 0;
                        } else {
                            gain_var = (gain_act.toFixed(2) - gain_tar.toFixed(2));
                        }
                        let pasitive;
                        let negative;
                        let j_pasitive;
                        let j_negative;

                        if (jmr_var < 0) {
                            negative = jmr_var.toFixed(2);
                            j_negative = jmr_var.toFixed(1);
                        }
                        else {
                            pasitive = jmr_var.toFixed(2);
                            j_pasitive = jmr_var.toFixed(1);
                        }
                        let pr_pasitive;
                        let pr_negative;
                        let p_pr_pasitive;
                        let p_pr_negative;
                        if (pr_var < 0) {
                            pr_negative = pr_var.toFixed(2);
                           // p_pr_negative = pr_var.toFixed(1);
                        }
                        else {
                            pr_pasitive = pr_var.toFixed(2);

                        }
                        if (poa_var < 0) {
                            p_pr_negative = pr_var.toFixed(1);
                        }
                        else {
                            p_pr_pasitive = pr_var.toFixed(1);
                        }
                       // console.log(result[i].tar_kwh);
                        target_energy.push((result[i].tar_kwh).toFixed(1));
                        actual_energy.push(result[i].act_kwh.toFixed(1));
                        pas_energy_var.push(j_pasitive);
                        neg_energy_var.push(j_negative);

                        //target_pr.push(result[i].tar_pr.toFixed(1));
                        //actual_pr.push(result[i].act_pr.toFixed(1));
                        //pas_pr_var.push(p_pr_pasitive);
                        //neg_pr_var.push(p_pr_negative);
                        target_pr.push(result[i].tar_poa.toFixed(1));
                        actual_pr.push(result[i].act_poa.toFixed(1));
                        pas_pr_var.push(p_pr_pasitive);
                        neg_pr_var.push(p_pr_negative);

                        revenue_arr.push(revenue.toFixed(2));

                        total_capacity += result[i].capacity;
                        total_tar_kwh += result[i].tar_kwh;
                        //total_expected_kwh += result[i].expected_kwh;
                        total_act_kwh += result[i].act_kwh;
                        total_revenue += revenue;
                        total_tar_ghi += result[i].tar_ghi;
                        total_act_ghi += result[i].act_ghi;
                        total_tar_poa += result[i].tar_poa;
                        total_act_poa += result[i].act_poa;
                        total_tar_gain += gain_tar;
                        total_act_gain += gain_act;
                        total_tar_plf += result[i].tar_plf;
                        total_act_plf += result[i].act_plf;
                        total_tar_pr += result[i].tar_pr;
                        total_act_pr += act_prval;
                        total_tar_ma += result[i].tar_ma;
                        total_act_ma += result[i].act_ma;
                        total_tar_iga += result[i].tar_iga;
                        total_act_iga += result[i].act_iga;
                        total_tar_ega += result[i].tar_ega;
                        total_act_ega += result[i].act_ega;
                        total_capTarGhi += result[i].tar_ghi * result[i].capacity;
                        total_capTarPoa += result[i].tar_poa * result[i].capacity;
                        total_capTarPlf += result[i].tar_plf * result[i].capacity;
                        total_capTarPr += result[i].tar_pr * result[i].capacity;
                        total_capTarGain += gain_tar * result[i].capacity;
                        total_capTarMa += result[i].tar_ma * result[i].capacity;
                        total_capTarIga += result[i].tar_iga * result[i].capacity;
                        total_capTarEga += result[i].tar_ega * result[i].capacity;
                        total_capActGhi += result[i].act_ghi * result[i].capacity;
                        total_capActPoa += result[i].act_poa * result[i].capacity;
                        total_capActPlf += result[i].act_plf * result[i].capacity;
                        total_capActPr += act_prval * result[i].capacity;
                        total_capActGain += gain_act * result[i].capacity;
                        total_capActMa += result[i].act_ma * result[i].capacity;
                        total_capActIga += result[i].act_iga * result[i].capacity;
                        total_capActEga += result[i].act_ega * result[i].capacity;

                        tbl += '<tr>';
                        //tbl += '<td class="text-left">' + result[i].site + '</td>';
                        tbl += '<td class="text-left">' + result[i].spv + '</td>';
                        //tbl += '<td class="text-right">' + result[i].total_mw.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].capacity.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_kwh.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_kwh.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + jmr_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + revenue.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_ghi.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ghi.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ghi_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_poa.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_poa.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + poa_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + gain_tar.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + gain_act.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + gain_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_plf.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_plf.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + plf_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_pr.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + act_prval.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + pr_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_ma.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ma.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ma_act_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_iga.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_iga.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + iga_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_ega.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ega.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ega_var.toFixed(2) + '</td>';
                        tbl += '</tr>';
                    }
                    let avg_jmr_var = 0;
                    //let avg_e_var = (((avg_act_kwh - avg_expected_kwh) / avg_expected_kwh) * 100);
                    let avg_tar_ghi = 0;
                    let avg_ghi_var = 0;
                    let avg_tar_plf = 0;
                    let avg_plf_var = 0;
                    let avg_tar_poa = 0;
                    let avg_poa_var = 0;
                    let avg_tar_gain = 0;
                    let avg_gain_var = 0;
                    let avg_tar_pr = 0;
                    let avg_pr_var = 0;
                    let avg_tar_ma = 0;
                    let avg_ma_var = 0;
                    let avg_tar_iga = 0;
                    let avg_iga_var = 0;
                    let avg_tar_ega = 0;
                    let avg_ega_var = 0;
                    let avg_act_ghi = 0
                    let avg_act_poa = 0;
                    let avg_act_plf = 0;
                    let avg_act_gain = 0;
                    let avg_act_pr = 0;
                    let avg_act_ma = 0;
                    let avg_act_iga = 0;
                    let avg_act_ega = 0;

                    if (total_capacity != 0) {
                        avg_tar_ghi = (total_capTarGhi / total_capacity);
                        avg_tar_plf = total_capTarPlf / total_capacity;
                        avg_tar_poa = total_capTarPoa / total_capacity;
                        avg_tar_gain = total_capTarGain / total_capacity;
                        avg_tar_pr = total_capTarPr / total_capacity;
                        avg_tar_ma = total_capTarMa / total_capacity;
                        avg_tar_iga = total_capTarIga / total_capacity;
                        avg_tar_ega = total_capTarEga / total_capacity;
                        avg_act_ghi = total_capActGhi / total_capacity;
                        avg_act_plf = total_capActPlf / total_capacity;
                        avg_act_poa = total_capActPoa / total_capacity;
                        avg_act_gain = total_capActGain / total_capacity;
                        avg_act_pr = total_capActPr / total_capacity;
                        avg_act_ma = total_capActMa / total_capacity;
                        avg_act_iga = total_capActIga / total_capacity;
                        avg_act_ega = total_capActEga / total_capacity;
                    }
                    if (total_tar_kwh != 0) {
                        avg_jmr_var = (((total_act_kwh.toFixed(2) - total_tar_kwh.toFixed(2)) / total_tar_kwh.toFixed(2)) * 100)
                    }
                    if (avg_tar_ghi != 0) {
                        avg_ghi_var = (((avg_act_ghi.toFixed(2) - avg_tar_ghi.toFixed(2)) / avg_tar_ghi.toFixed(2)) * 100);
                    }
                    if (avg_tar_poa != 0) {
                        avg_poa_var = (((avg_act_poa.toFixed(2) - avg_tar_poa.toFixed(2)) / avg_tar_poa.toFixed(2)) * 100);
                    }

                    avg_pr_var = (avg_act_pr.toFixed(2) - avg_tar_pr.toFixed(2));
                    avg_gain_var = (avg_act_gain.toFixed(2) - avg_tar_gain.toFixed(2));
                    avg_plf_var = (avg_act_plf.toFixed(2) - avg_tar_plf.toFixed(2));
                    avg_ma_var = (avg_act_ma.toFixed(2) - avg_tar_ma.toFixed(2));
                    avg_iga_var = (avg_act_iga.toFixed(2) - avg_tar_iga.toFixed(2));
                    avg_ega_var = (avg_act_ega.toFixed(2) - avg_tar_ega.toFixed(2));

                    tbl += '<tfoot><tr>';
                    tbl += '<th rowspan="1" colspan="1" style="width: 10%; font-weight: bold;">Grand Total</th>';
                    tbl += '<td class="text-right"><b>' + total_capacity.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_tar_kwh.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_act_kwh.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_jmr_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_revenue.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_ghi.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ghi.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ghi_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_poa.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_poa.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_poa_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_gain.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_gain.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_gain_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_plf.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_plf.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_plf_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_pr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_pr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_pr_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_ma.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ma.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ma_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_iga.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_iga.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_iga_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_ega.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ega.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ega_var.toFixed(2) + '</b></td>';

                    tbl += '</tr></tfoot>';
                }
                else {
                    //console.log("Data not available");

                }
                tbl += '</table>';
                $("#reportsDailySPV").html("").html(tbl);
                $.fn.DataTable.ext.pager.numbers_length = 6;
                $('#example3').DataTable({
                    dom: 'Bfrtip',
                    responsive: false,
                    lengthChange: false,
                    autoWidth: true,
                    paging: true,
                    lengthChange: false,
                    searching: true,
                    ordering: true,
                    info: true,
                    autoWidth: true,
                    responsive: false,
                    pageLength: 50,
                    buttons: [
                        {
                            extend: 'excel',
                            footer: true,
                            title: 'Solar Performance Reports Weekly SPV Wise',
                            //titleAttr: 'Export Excel',
                            "oSelectorOpts": { filter: 'applied', order: 'current' },
                            exportOptions: {
                                columns: ':visible',
                                modifier: {
                                    page: 'all'
                                },
                                format: {
                                    header: function (data, columnIdx) {
                                        if (columnIdx == 1) {
                                            return 'Capacity (MW)';
                                        }
                                        else if (columnIdx == 2) {
                                            return 'Energy (in MU)  Tar';
                                        }
                                        else if (columnIdx == 3) {
                                            return 'Energy (in MU)  Exp';
                                        }
                                        else if (columnIdx == 4) {
                                            return 'Energy (in MU)  Act';
                                        }
                                        else if (columnIdx == 5) {
                                            return 'Energy (in MU)  T.Var (%)';
                                        }
                                        else if (columnIdx == 6) {
                                            return 'Energy (in MU)  E.Var (%)';
                                        }
                                        else if (columnIdx == 7) {
                                            return 'Revenue (MINR) ';
                                        }
                                        else if (columnIdx == 8) {
                                            return `GHI (kWh/m^2)  Tar`;
                                        }
                                        else if (columnIdx == 9) {
                                            return 'GHI (kWh/m^2)  Act';
                                        }
                                        else if (columnIdx == 10) {
                                            return 'GHI (kWh/m^2)  Var (%) ';
                                        }
                                        else if (columnIdx == 11) {
                                            return 'POA (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 12) {
                                            return 'POA (kWh/m^2)  Act ';
                                        }
                                        else if (columnIdx == 13) {
                                            return 'POA (kWh/m^2) Var (%) ';
                                        }
                                        else if (columnIdx == 14) {
                                            return 'GHI VS POA Gain (%)  Tar';
                                        }
                                        else if (columnIdx == 15) {
                                            return 'GHI VS POA Gain (%)  Act ';
                                        }
                                        else if (columnIdx == 16) {
                                            return 'GHI VS POA Gain(%)  Var (%) ';
                                        }
                                        else if (columnIdx == 17) {
                                            return 'PLF (%)  Tar';
                                        }
                                        else if (columnIdx == 18) {
                                            return 'PLF (%)  Act ';
                                        }
                                        else if (columnIdx == 19) {
                                            return 'PLF (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 20) {
                                            return 'PR (%)  Tar';
                                        }
                                        else if (columnIdx == 21) {
                                            return 'PR (%)  Act ';
                                        }
                                        else if (columnIdx == 22) {
                                            return 'PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 23) {
                                            return 'MA (%)  Tar';
                                        }
                                        else if (columnIdx == 24) {
                                            return 'MA (%)  Act ';
                                        }
                                        else if (columnIdx == 25) {
                                            return 'MA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 26) {
                                            return 'IGA (%)  Tar';
                                        }
                                        else if (columnIdx == 27) {
                                            return 'IGA (%)  Act ';
                                        }
                                        else if (columnIdx == 28) {
                                            return 'IGA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 29) {
                                            return 'EGA (%)  Tar';
                                        }
                                        else if (columnIdx == 30) {
                                            return 'EGA (%)  Act ';
                                        }
                                        else if (columnIdx == 31) {
                                            return 'EGA (%)  Var (%) ';
                                        }
                                        else {
                                            return data;
                                        }
                                    }
                                }
                            }
                        },

                        {
                            extend: 'csv',
                            footer: true,
                            title: 'Solar Performance Reports Weekly SPV Wise',
                            //titleAttr: 'Export Excel',
                            "oSelectorOpts": { filter: 'applied', order: 'current' },
                            exportOptions: {
                                columns: ':visible',
                                modifier: {
                                    page: 'all'
                                },
                                format: {
                                    header: function (data, columnIdx) {
                                        if (columnIdx == 1) {
                                            return 'Capacity (MW)';
                                        }
                                        else if (columnIdx == 2) {
                                            return 'Energy (in MU)  Tar';
                                        }
                                        else if (columnIdx == 3) {
                                            return 'Energy (in MU)  Exp';
                                        }
                                        else if (columnIdx == 4) {
                                            return 'Energy (in MU)  Act';
                                        }
                                        else if (columnIdx == 5) {
                                            return 'Energy (in MU)  T.Var (%)';
                                        }
                                        else if (columnIdx == 6) {
                                            return 'Energy (in MU)  E.Var (%)';
                                        }
                                        else if (columnIdx == 7) {
                                            return 'Revenue (MINR) ';
                                        }
                                        else if (columnIdx == 8) {
                                            return 'GHI (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 9) {
                                            return 'GHI (kWh/m^2)  Act';
                                        }
                                        else if (columnIdx == 10) {
                                            return 'GHI (kWh/m^2)  Var (%) ';
                                        }
                                        else if (columnIdx == 11) {
                                            return 'POA (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 12) {
                                            return 'POA (kWh/m^2)  Act ';
                                        }
                                        else if (columnIdx == 13) {
                                            return 'POA (kWh/m^2) Var (%) ';
                                        }
                                        else if (columnIdx == 14) {
                                            return 'GHI VS POA Gain (%)  Tar';
                                        }
                                        else if (columnIdx == 15) {
                                            return 'GHI VS POA Gain (%)  Act ';
                                        }
                                        else if (columnIdx == 16) {
                                            return 'GHI VS POA Gain(%)  Var (%) ';
                                        }
                                        else if (columnIdx == 17) {
                                            return 'PLF (%)  Tar';
                                        }
                                        else if (columnIdx == 18) {
                                            return 'PLF (%)  Act ';
                                        }
                                        else if (columnIdx == 19) {
                                            return 'PLF (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 20) {
                                            return 'PR (%)  Tar';
                                        }
                                        else if (columnIdx == 21) {
                                            return 'PR (%)  Act ';
                                        }
                                        else if (columnIdx == 22) {
                                            return 'PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 23) {
                                            return 'MA (%)  Tar';
                                        }
                                        else if (columnIdx == 24) {
                                            return 'MA (%)  Act ';
                                        }
                                        else if (columnIdx == 25) {
                                            return 'MA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 26) {
                                            return 'IGA (%)  Tar';
                                        }
                                        else if (columnIdx == 27) {
                                            return 'IGA (%)  Act ';
                                        }
                                        else if (columnIdx == 28) {
                                            return 'IGA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 29) {
                                            return 'EGA (%)  Tar';
                                        }
                                        else if (columnIdx == 30) {
                                            return 'EGA (%)  Act ';
                                        }
                                        else if (columnIdx == 31) {
                                            return 'EGA (%)  Var (%) ';
                                        }
                                        else {
                                            return data;
                                        }
                                    }
                                }
                            }
                        },
                        'colvis'
                    ]
                });
                $(".dt-buttons").addClass('btn-group flex-wrap');
                $(".dt-buttons > button").addClass('btn btn-secondary');
                $(".dataTables_filter> label >input").addClass('form-control form-control-sm');
                //$('#example1').removeClass('dataTable');
                $('#example1').wrap("<div class='scrolledTable'></div>");

                EnergyBarChartSPV(target_energy, actual_energy, pas_energy_var, neg_energy_var, Levels);
                BarChartSPV(target_pr, actual_pr, pas_pr_var, neg_pr_var, Levels, 'PR(%)');


            }
        });

    }
    function EnergyBarChartSPV(target_energy, actual_energy, pas_energy_var, neg_energy_var, Levels) {

        let chartStatus = Chart.getChart("energy_chart_pr_spv"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        new Chart(document.getElementById("energy_chart_pr_spv"), {

            type: 'bar',
            data: {
                labels: Levels,
                datasets: [{
                    yAxisID: 'spv_en',
                    label: "Target Energy",
                    type: "bar",
                    backgroundColor: "#77CAE7",
                    data: target_energy,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'spv_en',
                        label: "Actual Energy",
                        type: "bar",
                        backgroundColor: "#31576D",
                        backgroundColorHover: "#3e95cd",
                        data: actual_energy,
                       order: 1,
                        datalabels: {
                            anchor: 'center',
                            align: 'top',
                            color: 'white',
                            labels: {
                                title: {
                                    font: {
                                        weight: 'bold'

                                    }
                                },
                            },
                        },
                    }, {
                    yAxisID: 'spv_var',
                        label: "(+ve) %",
                    type: "bubble",
                        borderColor: "#86C466",
                        data: pas_energy_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },

                    }, {
                    yAxisID: 'spv_var',
                        label: "(-ve) %",
                    type: "bubble",
                        borderColor: "#EE403D",
                        data: neg_energy_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },

                    }

                ]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Energy (MUs)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    spv_en: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    spv_var: {
                        type: 'linear',
                        position: 'right',
                        //ticks: { beginAtZero: true, },
                        ticks: {
                            display: false,
                        },
                        grid: { display: false }
                    },
                }
            }


        });

    }

    function BarChartSPV(target_wind, actual_wind, pas_wind_var, neg_wind_var, Levels, label) {
        let chartStatus = Chart.getChart("wind_chart_pr_spv"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        new Chart(document.getElementById("wind_chart_pr_spv"), {
            type: 'bar',
            data: {
                labels: Levels,
                datasets: [{
                    yAxisID: 'pr',
                    label: "Target Irr ",
                    type: "bar",
                    backgroundColor: "#77CAE7",
                    data: target_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr',
                    label: "Actual Irr ",
                    type: "bar",
                    backgroundColor: "#31576D",
                    backgroundColorHover: "#3e95cd",
                    data: actual_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr_var',
                    label: "(+ve) %",
                    type: "bubble",
                    borderColor: "#86C466",
                    data: pas_wind_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },
                }, {
                    yAxisID: 'pr_var',
                    label: "(-ve) %",
                    type: "bubble",
                    borderColor: "#EE403D",
                    data: neg_wind_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Irradiance (kWh/m^2)"
                    },
                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    pr: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    pr_var: {
                        type: 'linear',
                        position: 'right',
                        ticks: {
                            display: false,
                        },
                        grid: { display: false }
                    },
                }
            }
        });

    }
    //------------------------------------
    // Mothly Report SIte Wise
    function GetPerformanceBySite() {

        var daterange = $('#daterange').val();
        const dateArr = daterange.split("/");
        var seldate = new Date(dateArr[2], dateArr[1] - 1, dateArr[0]);
        var fromDate = GetWeeklyDays(seldate);
        var toDate = `${dateArr[2]}-${dateArr[1]}-${dateArr[0]}`;
        var fyear1 = fyear;//$('select#fy option:selected').val();
        var site_ids = "@Html.Raw(windSiteList.TrimEnd(','))";
        var reporthead = "Site Wise Reports";
        var Energy_Dataset = [];
        var Wind_Dataset = [];
        var actual_energy = [];
        var target_energy = [];
        var pas_energy_var = [];
        var neg_energy_var = [];

        var actual_pr = [];
        var target_pr = [];
        var pas_pr_var = [];
        var neg_pr_var = [];
        var Levels = [];

        $.ajax({
            type: "GET",
            url: '@Url.Action("GetSolarPRReportSiteWise", "SolarReport")' + '?fy=' + fyear1 + '&fromDate=' + fromDate + '&toDate=' + toDate + '&sitelist=' + site_ids,
            //url: "/WindReport/GetWindPRReportSiteWise?fy=" + fyear+" &fromDate=" + fromDate + "&toDate=" + toDate,
            contentType: "application/json; charset=utf-8",
            datatype: "JSON",
            success: function (result, status, xhr) {
                // console.log(result);
                // var tbl = '<div class="text-center"><h5>' + reporthead + '</h5></div>';

                var tbl = '<table id="example4"  class="table table-bordered table-striped" style="width:150%">';
                tbl += '<thead class="tbl-head"><tr>';
                tbl += '<th rowspan="2">Site</th><th  rowspan="2">Capacity <br>(MW)</th>';
                tbl += '<th colspan="3" class="text-center">Gen nos. (MUs)</th><th>Revenue</th>';
                tbl += '<th colspan="3" class="text-center">GHI (kWh/m<sup>2</sup>)</th><th colspan="3" class="text-center">POA (kWh/m<sup>2</sup>)</th><th colspan="3" class="text-center">GHI Vs POA Gain%</th>';
                tbl += '<th colspan="3" class="text-center">PLF (%)</th>';
                tbl += '<th colspan="3" class="text-center">PR (%)</th>';
                tbl += '<th colspan="3" class="text-center">MA Actual (%)</th><th colspan="3" class="text-center">IGA (%)</th>';
                tbl += '<th colspan="3" class="text-center">EGA (%)</th></tr>';
                // tbl += '<tr><th>&nbsp;</th>';

                tbl += '<tr><th>Tar</th>';
                tbl += '<th>Act JMR</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>(MINR)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';

                tbl += '<th>Tar</th>';
                tbl += '<th>Act</th>';
                tbl += '<th>Var (%)</th>';
                tbl += '</tr></thead>';


                if (result.length > 0) {

                    //let target_energy = [];
                    //let actual_energy = [];
                    //let pas_energy_var = [];
                    //let neg_energy_var = [];
                    //let target_wind = [];
                    //let actual_wind = [];
                    //let pas_wind_var = [];
                    //let neg_wind_var = [];
                    //console.log("Datatable");
                    let total_capacity = 0;
                    let total_tar_kwh = 0;
                    let total_act_kwh = 0;
                    // let total_expected_kwh = 0;
                    let total_revenue = 0;
                    let total_capTarGhi = 0;
                    let total_tar_ghi = 0;
                    let total_act_ghi = 0;
                    let total_capTarPlf = 0;
                    let total_tar_plf = 0;
                    let total_act_plf = 0;
                    let total_capTarGain = 0;
                    let total_tar_gain = 0;
                    let total_act_gain = 0;
                    let total_capTarPoa = 0;
                    let total_tar_poa = 0;
                    let total_act_poa = 0;
                    let total_capTarPr = 0;
                    let total_tar_pr = 0;
                    let total_act_pr = 0;
                    let total_capTarMa = 0;
                    let total_tar_ma = 0;
                    let total_act_ma = 0;
                    let total_capTarIga = 0;
                    let total_tar_iga = 0;
                    let total_act_iga = 0;
                    let total_capTarEga = 0;
                    let total_tar_ega = 0;
                    let total_act_ega = 0;
                    let total_capActGhi = 0;
                    let total_capActPlf = 0;
                    let total_capActGain = 0;
                    let total_capActPoa = 0;
                    let total_capActPr = 0;
                    let total_capActMa = 0;
                    let total_capActIga = 0;
                    let total_capActEga = 0;



                    for (var i = 0; i < result.length; i++) {

                        let revenue = 0;
                        let jmr_var = 0;
                        //let wind_var = 0;
                        let ghi_var = 0;
                        let poa_var = 0;
                        let plf_var = 0;
                        let ma_act_var = 0;
                        let iga_var = 0;
                        let ega_var = 0;
                        let pr_var = 0;
                        let gain_tar = 0;
                        let gain_act = 0;
                        let gain_var = 0;
                        let act_prval = 0;
                        revenue = (result[i].act_kwh - result[i].tar_kwh) * result[i].total_tarrif;
                        if (result[i].act_kwh != 0 || result[i].tar_kwh != 0) {
                            jmr_var = ((result[i].act_kwh - result[i].tar_kwh) / result[i].tar_kwh) * 100;
                        }
                        if (result[i].expected_kwh == 0 || result[i].act_kwh == 0) {
                            act_prval = 0;
                        }
                        else {
                            act_prval = (result[i].act_kwh / result[i].expected_kwh) * 100;
                        }
                        if (result[i].tar_ghi != 0) {
                            ghi_var = ((result[i].act_ghi.toFixed(2) - result[i].tar_ghi.toFixed(2)) / result[i].tar_ghi.toFixed(2)) * 100;
                        }
                        if (result[i].tar_poa != 0) {
                            poa_var = ((result[i].act_poa.toFixed(2) - result[i].tar_poa.toFixed(2)) / result[i].tar_poa.toFixed(2)) * 100;
                        }
                        
                        pr_var = (act_prval - result[i].tar_pr);
                        plf_var = (result[i].act_plf - result[i].tar_plf);
                        ma_act_var = (result[i].act_ma - result[i].tar_ma);
                        iga_var = (result[i].act_iga - result[i].tar_iga);
                        ega_var = (result[i].act_ega - result[i].tar_ega);


                        if (result[i].tar_poa == 0 || result[i].tar_ghi == 0) {
                            gain_tar = 0;
                        } else {
                            gain_tar = (result[i].tar_poa / result[i].tar_ghi) * 100;
                        }
                        if (result[i].act_poa == 0 || result[i].act_ghi == 0) {
                            gain_act = 0;
                        } else {
                            gain_act = (result[i].act_poa / result[i].act_ghi) * 100;
                        }
                        if (gain_act == 0 || gain_tar == 0) {
                            gain_var = 0;
                        } else {
                            gain_var = ((gain_act - gain_tar) / gain_tar) * 100;
                        }


                        let pasitive;
                        let negative;
                        let e_pasitive;
                        let e_negative;
                        if (jmr_var < 0) {
                            negative = jmr_var.toFixed(2);
                            e_negative = jmr_var.toFixed(1);
                        }
                        else {
                            pasitive = jmr_var.toFixed(2);
                            e_pasitive = jmr_var.toFixed(1);
                        }
                        let pr_pasitive;
                        let pr_negative;
                        let pr_pasitive_p;
                        let pr_negative_p;
                        if (pr_var < 0) {
                            pr_negative = pr_var.toFixed(2);

                        }
                        else {
                            pr_pasitive = pr_var.toFixed(2);

                        }

                        if (poa_var < 0) {
                            pr_negative_p = pr_var.toFixed(1)
                        }
                        else {
                            pr_pasitive_p = pr_var.toFixed(1)
                        }

                        //console.log(result[i].tar_kwh);
                        target_energy.push((result[i].tar_kwh).toFixed(1));
                        actual_energy.push(result[i].act_kwh.toFixed(1));
                        pas_energy_var.push(pasitive);
                        neg_energy_var.push(negative);
                        Levels.push(result[i].site);

                        //target_pr.push(result[i].tar_pr.toFixed(1));
                        //actual_pr.push(result[i].act_pr.toFixed(1));
                        //pas_pr_var.push(pr_pasitive);
                        //neg_pr_var.push(pr_negative);

                        target_pr.push(result[i].tar_poa.toFixed(1));
                        actual_pr.push(result[i].act_poa.toFixed(1));
                        pas_pr_var.push(pr_pasitive);
                        neg_pr_var.push(pr_negative);
                        total_capacity += result[i].capacity;
                        total_tar_kwh += result[i].tar_kwh;
                        //total_expected_kwh += result[i].expected_kwh;
                        total_act_kwh += result[i].act_kwh;
                        total_revenue += revenue;
                        total_tar_ghi += result[i].tar_ghi;
                        total_act_ghi += result[i].act_ghi;
                        total_tar_poa += result[i].tar_poa;
                        total_act_poa += result[i].act_poa;
                        total_tar_gain += gain_tar;
                        total_act_gain += gain_act;
                        total_tar_plf += result[i].tar_plf;
                        total_act_plf += result[i].act_plf;
                        total_tar_pr += result[i].tar_pr;
                        total_act_pr += act_prval;
                        total_tar_ma += result[i].tar_ma;
                        total_act_ma += result[i].act_ma;
                        total_tar_iga += result[i].tar_iga;
                        total_act_iga += result[i].act_iga;
                        total_tar_ega += result[i].tar_ega;
                        total_act_ega += result[i].act_ega;
                        total_capTarGhi += result[i].tar_ghi * result[i].capacity;
                        total_capTarPoa += result[i].tar_poa * result[i].capacity;
                        total_capTarPlf += result[i].tar_plf * result[i].capacity;
                        total_capTarPr += result[i].tar_pr * result[i].capacity;
                        total_capTarGain += gain_tar * result[i].capacity;
                        total_capTarMa += result[i].tar_ma * result[i].capacity
                        total_capTarIga += result[i].tar_iga * result[i].capacity;
                        total_capTarEga += result[i].tar_ega * result[i].capacity;
                        total_capActGhi += result[i].act_ghi * result[i].capacity;
                        total_capActPoa += result[i].act_poa * result[i].capacity;
                        total_capActPlf += result[i].act_plf * result[i].capacity;
                        total_capActPr += act_prval * result[i].capacity;
                        total_capActGain += gain_act * result[i].capacity;
                        total_capActMa += result[i].act_ma * result[i].capacity;
                        total_capActIga += result[i].act_iga * result[i].capacity;
                        total_capActEga += result[i].act_ega * result[i].capacity;

                        tbl += '<tr>';
                        tbl += '<td class="text-left">' + result[i].site + '</td>';
                        //tbl += '<td class="text-right">' + result[i].total_mw.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].capacity.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_kwh.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_kwh.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + jmr_var.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + revenue.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].tar_ghi.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ghi.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ghi_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + result[i].tar_poa.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_poa.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + poa_var.toFixed(2) + '</td>';

                        tbl += '<td class="text-right">' + gain_tar.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + gain_act.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + gain_var.toFixed(2) + '</td>';


                        tbl += '<td class="text-right">' + result[i].tar_plf.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_plf.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + plf_var.toFixed(2) + '</td>';



                        tbl += '<td class="text-right">' + result[i].tar_pr.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + act_prval.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + plf_var.toFixed(2) + '</td>';


                        tbl += '<td class="text-right">' + result[i].tar_ma.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ma.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ma_act_var.toFixed(2) + '</td>';


                        tbl += '<td class="text-right">' + result[i].tar_iga.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_iga.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + iga_var.toFixed(2) + '</td>';


                        tbl += '<td class="text-right">' + result[i].tar_ega.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + result[i].act_ega.toFixed(2) + '</td>';
                        tbl += '<td class="text-right">' + ega_var.toFixed(2) + '</td>';

                        tbl += '</tr>';
                    }

                    let avg_jmr_var = 0;
                    //let avg_e_var = (((avg_act_kwh - avg_expected_kwh) / avg_expected_kwh) * 100);
                    let avg_tar_ghi = 0;
                    let avg_ghi_var = 0;
                    let avg_tar_plf = 0;
                    let avg_plf_var = 0;
                    let avg_tar_poa = 0;
                    let avg_poa_var = 0;
                    let avg_tar_gain = 0;
                    let avg_gain_var = 0;
                    let avg_tar_pr = 0;
                    let avg_pr_var = 0;
                    let avg_tar_ma = 0;
                    let avg_ma_var = 0;
                    let avg_tar_iga = 0;
                    let avg_iga_var = 0;
                    let avg_tar_ega = 0;
                    let avg_ega_var = 0;
                    let avg_act_ghi = 0
                    let avg_act_poa = 0;
                    let avg_act_plf = 0;
                    let avg_act_gain = 0;
                    let avg_act_pr = 0;
                    let avg_act_ma = 0;
                    let avg_act_iga = 0;
                    let avg_act_ega = 0;

                    if (total_capacity != 0) {
                        avg_tar_ghi = (total_capTarGhi / total_capacity);
                        avg_tar_plf = total_capTarPlf / total_capacity;
                        avg_tar_poa = total_capTarPoa / total_capacity;
                        avg_tar_gain = total_capTarGain / total_capacity;
                        avg_tar_pr = total_capTarPr / total_capacity;
                        avg_tar_ma = total_capTarMa / total_capacity;
                        avg_tar_iga = total_capTarIga / total_capacity;
                        avg_tar_ega = total_capTarEga / total_capacity;
                        avg_act_ghi = total_capActGhi / total_capacity;
                        avg_act_plf = total_capActPlf / total_capacity;
                        avg_act_poa = total_capActPoa / total_capacity;
                        avg_act_gain = total_capActGain / total_capacity;
                        avg_act_pr = total_capActPr / total_capacity;
                        avg_act_ma = total_capActMa / total_capacity;
                        avg_act_iga = total_capActIga / total_capacity;
                        avg_act_ega = total_capActEga / total_capacity;
                    }
                    if (total_tar_kwh != 0) {
                        avg_jmr_var = (((total_act_kwh.toFixed(2) - total_tar_kwh.toFixed(2)) / total_tar_kwh.toFixed(2)) * 100)
                    }
                    if (avg_tar_ghi != 0) {
                        avg_ghi_var = (((avg_act_ghi.toFixed(2) - avg_tar_ghi.toFixed(2)) / avg_tar_ghi.toFixed(2)) * 100);
                    }
                    if (avg_tar_poa != 0) {
                        avg_poa_var = (((avg_act_poa.toFixed(2) - avg_tar_poa.toFixed(2)) / avg_tar_poa.toFixed(2)) * 100);
                    }

                    avg_pr_var = (avg_act_pr.toFixed(2) - avg_tar_pr.toFixed(2));
                    avg_gain_var = (avg_act_gain.toFixed(2) - avg_tar_gain.toFixed(2));
                    avg_plf_var = (avg_act_plf.toFixed(2) - avg_tar_plf.toFixed(2));
                    avg_ma_var = (avg_act_ma.toFixed(2) - avg_tar_ma.toFixed(2));
                    avg_iga_var = (avg_act_iga.toFixed(2) - avg_tar_iga.toFixed(2));
                    avg_ega_var = (avg_act_ega.toFixed(2) - avg_tar_ega.toFixed(2));

                    tbl += '<tfoot><tr>';
                    tbl += '<th rowspan="1" colspan="1" style="width: 10%; font-weight: bold;">Grand Total</th>';
                    tbl += '<td class="text-right"><b>' + total_capacity.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_tar_kwh.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_act_kwh.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_jmr_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + total_revenue.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_ghi.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ghi.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ghi_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_poa.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_poa.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_poa_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_gain.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_gain.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_gain_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_plf.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_plf.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_plf_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_pr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_pr.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_pr_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_ma.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ma.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ma_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_iga.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_iga.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_iga_var.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_tar_ega.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_act_ega.toFixed(2) + '</b></td>';
                    tbl += '<td class="text-right"><b>' + avg_ega_var.toFixed(2) + '</b></td>';

                    tbl += '</tr></tfoot>';
                }
                else {
                    //console.log("Data not available");

                }
                tbl += '</table>';
                $("#reportsDailySite").html("").html(tbl);
                $.fn.DataTable.ext.pager.numbers_length = 6;
                $('#example4').DataTable({
                    dom: 'Bfrtip',
                    responsive: false,
                    lengthChange: false,
                    autoWidth: true,
                    paging: true,
                    lengthChange: false,
                    searching: true,
                    ordering: true,
                    info: true,
                    autoWidth: true,
                    responsive: false,
                    pageLength: 50,
                    buttons: [
                        {
                            extend: 'excel',
                            footer: true,
                            title: 'Solar Performance Reports Weekly Site Wise',
                            //titleAttr: 'Export Excel',
                            "oSelectorOpts": { filter: 'applied', order: 'current' },
                            exportOptions: {
                                columns: ':visible',
                                modifier: {
                                    page: 'all'
                                },
                                format: {
                                    header: function (data, columnIdx) {
                                        if (columnIdx == 1) {
                                            return 'Capacity (MW)';
                                        }
                                        else if (columnIdx == 2) {
                                            return 'Energy (in MU)  Tar';
                                        }
                                        else if (columnIdx == 3) {
                                            return 'Energy (in MU)  Exp';
                                        }
                                        else if (columnIdx == 4) {
                                            return 'Energy (in MU)  Act';
                                        }
                                        else if (columnIdx == 5) {
                                            return 'Energy (in MU)  T.Var (%)';
                                        }
                                        else if (columnIdx == 6) {
                                            return 'Energy (in MU)  E.Var (%)';
                                        }
                                        else if (columnIdx == 7) {
                                            return 'Revenue (MINR) ';
                                        }
                                        else if (columnIdx == 8) {
                                            hP
                                            return `GHI (kWh/m^2)  Tar`;
                                        }
                                        else if (columnIdx == 9) {
                                            return 'GHI (kWh/m^2)  Act';
                                        }
                                        else if (columnIdx == 10) {
                                            return 'GHI (kWh/m^2)  Var (%) ';
                                        }
                                        else if (columnIdx == 11) {
                                            return 'POA (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 12) {
                                            return 'POA (kWh/m^2)  Act ';
                                        }
                                        else if (columnIdx == 13) {
                                            return 'POA (kWh/m^2) Var (%) ';
                                        }
                                        else if (columnIdx == 14) {
                                            return 'GHI VS POA Gain (%)  Tar';
                                        }
                                        else if (columnIdx == 15) {
                                            return 'GHI VS POA Gain (%)  Act ';
                                        }
                                        else if (columnIdx == 16) {
                                            return 'GHI VS POA Gain(%)  Var (%) ';
                                        }
                                        else if (columnIdx == 17) {
                                            return 'PLF (%)  Tar';
                                        }
                                        else if (columnIdx == 18) {
                                            return 'PLF (%)  Act ';
                                        }
                                        else if (columnIdx == 19) {
                                            return 'PLF (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 20) {
                                            return 'PR (%)  Tar';
                                        }
                                        else if (columnIdx == 21) {
                                            return 'PR (%)  Act ';
                                        }
                                        else if (columnIdx == 22) {
                                            return 'PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 23) {
                                            return 'MA (%)  Tar';
                                        }
                                        else if (columnIdx == 24) {
                                            return 'MA (%)  Act ';
                                        }
                                        else if (columnIdx == 25) {
                                            return 'MA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 26) {
                                            return 'IGA (%)  Tar';
                                        }
                                        else if (columnIdx == 27) {
                                            return 'IGA (%)  Act ';
                                        }
                                        else if (columnIdx == 28) {
                                            return 'IGA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 29) {
                                            return 'EGA (%)  Tar';
                                        }
                                        else if (columnIdx == 30) {
                                            return 'EGA (%)  Act ';
                                        }
                                        else if (columnIdx == 31) {
                                            return 'EGA (%)  Var (%) ';
                                        }
                                        else {
                                            return data;
                                        }
                                    }
                                }
                            }
                        },
                        {
                            extend: 'csv',
                            footer: true,
                            title: 'Solar Performance Reports Weekly Site Wise',
                            //titleAttr: 'Export Excel',
                            "oSelectorOpts": { filter: 'applied', order: 'current' },
                            exportOptions: {
                                columns: ':visible',
                                modifier: {
                                    page: 'all'
                                },
                                format: {
                                    header: function (data, columnIdx) {
                                        if (columnIdx == 1) {
                                            return 'Capacity (MW)';
                                        }
                                        else if (columnIdx == 2) {
                                            return 'Energy (in MU)  Tar';
                                        }
                                        else if (columnIdx == 3) {
                                            return 'Energy (in MU)  Exp';
                                        }
                                        else if (columnIdx == 4) {
                                            return 'Energy (in MU)  Act';
                                        }
                                        else if (columnIdx == 5) {
                                            return 'Energy (in MU)  T.Var (%)';
                                        }
                                        else if (columnIdx == 6) {
                                            return 'Energy (in MU)  E.Var (%)';
                                        }
                                        else if (columnIdx == 7) {
                                            return 'Revenue (MINR) ';
                                        }
                                        else if (columnIdx == 8) {
                                            return 'GHI (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 9) {
                                            return 'GHI (kWh/m^2)  Act';
                                        }
                                        else if (columnIdx == 10) {
                                            return 'GHI (kWh/m^2)  Var (%) ';
                                        }
                                        else if (columnIdx == 11) {
                                            return 'POA (kWh/m^2)  Tar';
                                        }
                                        else if (columnIdx == 12) {
                                            return 'POA (kWh/m^2)  Act ';
                                        }
                                        else if (columnIdx == 13) {
                                            return 'POA (kWh/m^2) Var (%) ';
                                        }
                                        else if (columnIdx == 14) {
                                            return 'GHI VS POA Gain (%)  Tar';
                                        }
                                        else if (columnIdx == 15) {
                                            return 'GHI VS POA Gain (%)  Act ';
                                        }
                                        else if (columnIdx == 16) {
                                            return 'GHI VS POA Gain(%)  Var (%) ';
                                        }
                                        else if (columnIdx == 17) {
                                            return 'PLF (%)  Tar';
                                        }
                                        else if (columnIdx == 18) {
                                            return 'PLF (%)  Act ';
                                        }
                                        else if (columnIdx == 19) {
                                            return 'PLF (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 20) {
                                            return 'PR (%)  Tar';
                                        }
                                        else if (columnIdx == 21) {
                                            return 'PR (%)  Act ';
                                        }
                                        else if (columnIdx == 22) {
                                            return 'PR (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 23) {
                                            return 'MA (%)  Tar';
                                        }
                                        else if (columnIdx == 24) {
                                            return 'MA (%)  Act ';
                                        }
                                        else if (columnIdx == 25) {
                                            return 'MA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 26) {
                                            return 'IGA (%)  Tar';
                                        }
                                        else if (columnIdx == 27) {
                                            return 'IGA (%)  Act ';
                                        }
                                        else if (columnIdx == 28) {
                                            return 'IGA (%)  Var (%) ';
                                        }
                                        else if (columnIdx == 29) {
                                            return 'EGA (%)  Tar';
                                        }
                                        else if (columnIdx == 30) {
                                            return 'EGA (%)  Act ';
                                        }
                                        else if (columnIdx == 31) {
                                            return 'EGA (%)  Var (%) ';
                                        }
                                        else {
                                            return data;
                                        }
                                    }
                                }
                            }
                        },
                        'colvis'
                    ]
                });
                $(".dt-buttons").addClass('btn-group flex-wrap');
                $(".dt-buttons > button").addClass('btn btn-secondary');
                $(".dataTables_filter> label >input").addClass('form-control form-control-sm');
                //$('#example2').removeClass('dataTable');
                $('#example2').wrap("<div class='scrolledTable'></div>");
                EnergyBarChartSite(target_energy, actual_energy, pas_energy_var, neg_energy_var, Levels);
                BarChartSite(target_pr, actual_pr, pas_pr_var, neg_pr_var, Levels, 'PR(%)');
            }
        });
    }
    function EnergyBarChartSite(target_energy, actual_energy, pas_energy_var, neg_energy_var, Levels) {

        let chartStatus = Chart.getChart("energy_chart_pr_site"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        new Chart(document.getElementById("energy_chart_pr_site"), {

            type: 'bar',
            data: {
                labels: Levels,
                datasets: [{
                    yAxisID: 'pr_en_p',
                    label: "Target Energy",
                    type: "bar",
                    backgroundColor: "#77CAE7",
                    data: target_energy,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr_en_p',
                    label: "Actual Energy",
                    type: "bar",
                    backgroundColor: "#31576D",
                    backgroundColorHover: "#3e95cd",
                    data: actual_energy,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr_var_p',
                    label: "(+ve) %",
                    type: "bubble",
                    borderColor: "#86C466",
                    data: pas_energy_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },

                }, {
                    yAxisID: 'pr_var_p',
                    label: "(-ve) %",
                    type: "bubble",
                    borderColor: "#EE403D",
                    data: neg_energy_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },

                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Energy (MUs)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    pr_en_p: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    pr_var_p: {
                        type: 'linear',
                        position: 'right',
                        //ticks: { beginAtZero: true, },
                        ticks: {
                            display: false,
                        },
                        grid: { display: false }
                    },
                }
            }


        });

    }

    function BarChartSite(target_wind, actual_wind, pas_wind_var, neg_wind_var, Levels, label) {
        let chartStatus = Chart.getChart("wind_chart_pr_site"); // <canvas> id
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }
        new Chart(document.getElementById("wind_chart_pr_site"), {
            type: 'bar',
            data: {
                labels: Levels,
                datasets: [{
                    yAxisID: 'pr_en_s',
                    label: "Target Irr",
                    type: "bar",
                    backgroundColor: "#77CAE7",
                    data: target_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr_en_s',
                    label: "Actual Irr ",
                    type: "bar",
                    backgroundColor: "#31576D",
                    backgroundColorHover: "#3e95cd",
                    data: actual_wind,
                    order: 1,
                    datalabels: {
                        anchor: 'center',
                        align: 'top',
                        color: 'white',
                        labels: {
                            title: {
                                font: {
                                    weight: 'bold'

                                }
                            },
                        },
                    },
                }, {
                    yAxisID: 'pr_var_s',
                    label: "(+ve) %",
                    type: "bubble",
                    borderColor: "#86C466",
                    data: pas_wind_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },
                }, {
                    yAxisID: 'pr_var_s',
                    label: "(-ve) %",
                    type: "bubble",
                    borderColor: "#EE403D",
                    data: neg_wind_var,
                    order: 0,
                    fill: false,
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5
                    },
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "Irrdiance (kWh/m^2)"
                    },

                    legend: {
                        display: true,
                        position: "bottom"
                    }

                },
                scales: {
                    pr_en_s: {
                        type: 'linear',
                        position: 'left',
                        grid: { display: false }
                    },
                    pr_var_s: {
                        type: 'linear',
                        position: 'right',
                        //ticks: { beginAtZero: true, },
                        ticks: {
                            display: false,
                        },
                        grid: { display: false }
                    },
                }
            }
        });

    }



</script>
